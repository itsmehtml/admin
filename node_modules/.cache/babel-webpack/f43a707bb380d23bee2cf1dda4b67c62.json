{"ast":null,"code":"/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\nvar _config = require(\"../config\");\n\nvar __DEV__ = _config.__DEV__;\n\nvar zrUtil = require(\"zrender/lib/core/util\");\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\n\n\nvar TYPE_DELIMITER = '.';\nvar IS_CONTAINER = '___EC__COMPONENT__CONTAINER___';\n/**\r\n * Notice, parseClassType('') should returns {main: '', sub: ''}\r\n * @public\r\n */\n\nfunction parseClassType(componentType) {\n  var ret = {\n    main: '',\n    sub: ''\n  };\n\n  if (componentType) {\n    componentType = componentType.split(TYPE_DELIMITER);\n    ret.main = componentType[0] || '';\n    ret.sub = componentType[1] || '';\n  }\n\n  return ret;\n}\n/**\r\n * @public\r\n */\n\n\nfunction checkClassType(componentType) {\n  zrUtil.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(componentType), 'componentType \"' + componentType + '\" illegal');\n}\n/**\r\n * @public\r\n */\n\n\nfunction enableClassExtend(RootClass, mandatoryMethods) {\n  RootClass.$constructor = RootClass;\n\n  RootClass.extend = function (proto) {\n    var superClass = this;\n\n    var ExtendedClass = function ExtendedClass() {\n      if (!proto.$constructor) {\n        superClass.apply(this, arguments);\n      } else {\n        proto.$constructor.apply(this, arguments);\n      }\n    };\n\n    zrUtil.extend(ExtendedClass.prototype, proto);\n    ExtendedClass.extend = this.extend;\n    ExtendedClass.superCall = superCall;\n    ExtendedClass.superApply = superApply;\n    zrUtil.inherits(ExtendedClass, this);\n    ExtendedClass.superClass = superClass;\n    return ExtendedClass;\n  };\n}\n\nvar classBase = 0;\n/**\r\n * Can not use instanceof, consider different scope by\r\n * cross domain or es module import in ec extensions.\r\n * Mount a method \"isInstance()\" to Clz.\r\n */\n\nfunction enableClassCheck(Clz) {\n  var classAttr = ['__\\0is_clz', classBase++, Math.random().toFixed(3)].join('_');\n  Clz.prototype[classAttr] = true;\n\n  Clz.isInstance = function (obj) {\n    return !!(obj && obj[classAttr]);\n  };\n} // superCall should have class info, which can not be fetch from 'this'.\n// Consider this case:\n// class A has method f,\n// class B inherits class A, overrides method f, f call superApply('f'),\n// class C inherits class B, do not overrides method f,\n// then when method of class C is called, dead loop occured.\n\n\nfunction superCall(context, methodName) {\n  var args = zrUtil.slice(arguments, 2);\n  return this.superClass.prototype[methodName].apply(context, args);\n}\n\nfunction superApply(context, methodName, args) {\n  return this.superClass.prototype[methodName].apply(context, args);\n}\n/**\r\n * @param {Object} entity\r\n * @param {Object} options\r\n * @param {boolean} [options.registerWhenExtend]\r\n * @public\r\n */\n\n\nfunction enableClassManagement(entity, options) {\n  options = options || {};\n  /**\r\n   * Component model classes\r\n   * key: componentType,\r\n   * value:\r\n   *     componentClass, when componentType is 'xxx'\r\n   *     or Object.<subKey, componentClass>, when componentType is 'xxx.yy'\r\n   * @type {Object}\r\n   */\n\n  var storage = {};\n\n  entity.registerClass = function (Clazz, componentType) {\n    if (componentType) {\n      checkClassType(componentType);\n      componentType = parseClassType(componentType);\n\n      if (!componentType.sub) {\n        storage[componentType.main] = Clazz;\n      } else if (componentType.sub !== IS_CONTAINER) {\n        var container = makeContainer(componentType);\n        container[componentType.sub] = Clazz;\n      }\n    }\n\n    return Clazz;\n  };\n\n  entity.getClass = function (componentMainType, subType, throwWhenNotFound) {\n    var Clazz = storage[componentMainType];\n\n    if (Clazz && Clazz[IS_CONTAINER]) {\n      Clazz = subType ? Clazz[subType] : null;\n    }\n\n    if (throwWhenNotFound && !Clazz) {\n      throw new Error(!subType ? componentMainType + '.' + 'type should be specified.' : 'Component ' + componentMainType + '.' + (subType || '') + ' not exists. Load it first.');\n    }\n\n    return Clazz;\n  };\n\n  entity.getClassesByMainType = function (componentType) {\n    componentType = parseClassType(componentType);\n    var result = [];\n    var obj = storage[componentType.main];\n\n    if (obj && obj[IS_CONTAINER]) {\n      zrUtil.each(obj, function (o, type) {\n        type !== IS_CONTAINER && result.push(o);\n      });\n    } else {\n      result.push(obj);\n    }\n\n    return result;\n  };\n\n  entity.hasClass = function (componentType) {\n    // Just consider componentType.main.\n    componentType = parseClassType(componentType);\n    return !!storage[componentType.main];\n  };\n  /**\r\n   * @return {Array.<string>} Like ['aa', 'bb'], but can not be ['aa.xx']\r\n   */\n\n\n  entity.getAllClassMainTypes = function () {\n    var types = [];\n    zrUtil.each(storage, function (obj, type) {\n      types.push(type);\n    });\n    return types;\n  };\n  /**\r\n   * If a main type is container and has sub types\r\n   * @param  {string}  mainType\r\n   * @return {boolean}\r\n   */\n\n\n  entity.hasSubTypes = function (componentType) {\n    componentType = parseClassType(componentType);\n    var obj = storage[componentType.main];\n    return obj && obj[IS_CONTAINER];\n  };\n\n  entity.parseClassType = parseClassType;\n\n  function makeContainer(componentType) {\n    var container = storage[componentType.main];\n\n    if (!container || !container[IS_CONTAINER]) {\n      container = storage[componentType.main] = {};\n      container[IS_CONTAINER] = true;\n    }\n\n    return container;\n  }\n\n  if (options.registerWhenExtend) {\n    var originalExtend = entity.extend;\n\n    if (originalExtend) {\n      entity.extend = function (proto) {\n        var ExtendedClass = originalExtend.call(this, proto);\n        return entity.registerClass(ExtendedClass, proto.type);\n      };\n    }\n  }\n\n  return entity;\n}\n/**\r\n * @param {string|Array.<string>} properties\r\n */\n\n\nfunction setReadOnly(obj, properties) {// FIXME It seems broken in IE8 simulation of IE11\n  // if (!zrUtil.isArray(properties)) {\n  //     properties = properties != null ? [properties] : [];\n  // }\n  // zrUtil.each(properties, function (prop) {\n  //     var value = obj[prop];\n  //     Object.defineProperty\n  //         && Object.defineProperty(obj, prop, {\n  //             value: value, writable: false\n  //         });\n  //     zrUtil.isArray(obj[prop])\n  //         && Object.freeze\n  //         && Object.freeze(obj[prop]);\n  // });\n}\n\nexports.parseClassType = parseClassType;\nexports.enableClassExtend = enableClassExtend;\nexports.enableClassCheck = enableClassCheck;\nexports.enableClassManagement = enableClassManagement;\nexports.setReadOnly = setReadOnly;","map":{"version":3,"sources":["C:/Users/user/Desktop/Admin/node_modules/echarts/lib/util/clazz.js"],"names":["_config","require","__DEV__","zrUtil","TYPE_DELIMITER","IS_CONTAINER","parseClassType","componentType","ret","main","sub","split","checkClassType","assert","test","enableClassExtend","RootClass","mandatoryMethods","$constructor","extend","proto","superClass","ExtendedClass","apply","arguments","prototype","superCall","superApply","inherits","classBase","enableClassCheck","Clz","classAttr","Math","random","toFixed","join","isInstance","obj","context","methodName","args","slice","enableClassManagement","entity","options","storage","registerClass","Clazz","container","makeContainer","getClass","componentMainType","subType","throwWhenNotFound","Error","getClassesByMainType","result","each","o","type","push","hasClass","getAllClassMainTypes","types","hasSubTypes","registerWhenExtend","originalExtend","call","setReadOnly","properties","exports"],"mappings":"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","sourcesContent":["\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\n\r\nvar _config = require(\"../config\");\r\n\r\nvar __DEV__ = _config.__DEV__;\r\n\r\nvar zrUtil = require(\"zrender/lib/core/util\");\r\n\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\nvar TYPE_DELIMITER = '.';\r\nvar IS_CONTAINER = '___EC__COMPONENT__CONTAINER___';\r\n/**\r\n * Notice, parseClassType('') should returns {main: '', sub: ''}\r\n * @public\r\n */\r\n\r\nfunction parseClassType(componentType) {\r\n  var ret = {\r\n    main: '',\r\n    sub: ''\r\n  };\r\n\r\n  if (componentType) {\r\n    componentType = componentType.split(TYPE_DELIMITER);\r\n    ret.main = componentType[0] || '';\r\n    ret.sub = componentType[1] || '';\r\n  }\r\n\r\n  return ret;\r\n}\r\n/**\r\n * @public\r\n */\r\n\r\n\r\nfunction checkClassType(componentType) {\r\n  zrUtil.assert(/^[a-zA-Z0-9_]+([.][a-zA-Z0-9_]+)?$/.test(componentType), 'componentType \"' + componentType + '\" illegal');\r\n}\r\n/**\r\n * @public\r\n */\r\n\r\n\r\nfunction enableClassExtend(RootClass, mandatoryMethods) {\r\n  RootClass.$constructor = RootClass;\r\n\r\n  RootClass.extend = function (proto) {\r\n    var superClass = this;\r\n\r\n    var ExtendedClass = function () {\r\n      if (!proto.$constructor) {\r\n        superClass.apply(this, arguments);\r\n      } else {\r\n        proto.$constructor.apply(this, arguments);\r\n      }\r\n    };\r\n\r\n    zrUtil.extend(ExtendedClass.prototype, proto);\r\n    ExtendedClass.extend = this.extend;\r\n    ExtendedClass.superCall = superCall;\r\n    ExtendedClass.superApply = superApply;\r\n    zrUtil.inherits(ExtendedClass, this);\r\n    ExtendedClass.superClass = superClass;\r\n    return ExtendedClass;\r\n  };\r\n}\r\n\r\nvar classBase = 0;\r\n/**\r\n * Can not use instanceof, consider different scope by\r\n * cross domain or es module import in ec extensions.\r\n * Mount a method \"isInstance()\" to Clz.\r\n */\r\n\r\nfunction enableClassCheck(Clz) {\r\n  var classAttr = ['__\\0is_clz', classBase++, Math.random().toFixed(3)].join('_');\r\n  Clz.prototype[classAttr] = true;\r\n\r\n  Clz.isInstance = function (obj) {\r\n    return !!(obj && obj[classAttr]);\r\n  };\r\n} // superCall should have class info, which can not be fetch from 'this'.\r\n// Consider this case:\r\n// class A has method f,\r\n// class B inherits class A, overrides method f, f call superApply('f'),\r\n// class C inherits class B, do not overrides method f,\r\n// then when method of class C is called, dead loop occured.\r\n\r\n\r\nfunction superCall(context, methodName) {\r\n  var args = zrUtil.slice(arguments, 2);\r\n  return this.superClass.prototype[methodName].apply(context, args);\r\n}\r\n\r\nfunction superApply(context, methodName, args) {\r\n  return this.superClass.prototype[methodName].apply(context, args);\r\n}\r\n/**\r\n * @param {Object} entity\r\n * @param {Object} options\r\n * @param {boolean} [options.registerWhenExtend]\r\n * @public\r\n */\r\n\r\n\r\nfunction enableClassManagement(entity, options) {\r\n  options = options || {};\r\n  /**\r\n   * Component model classes\r\n   * key: componentType,\r\n   * value:\r\n   *     componentClass, when componentType is 'xxx'\r\n   *     or Object.<subKey, componentClass>, when componentType is 'xxx.yy'\r\n   * @type {Object}\r\n   */\r\n\r\n  var storage = {};\r\n\r\n  entity.registerClass = function (Clazz, componentType) {\r\n    if (componentType) {\r\n      checkClassType(componentType);\r\n      componentType = parseClassType(componentType);\r\n\r\n      if (!componentType.sub) {\r\n        storage[componentType.main] = Clazz;\r\n      } else if (componentType.sub !== IS_CONTAINER) {\r\n        var container = makeContainer(componentType);\r\n        container[componentType.sub] = Clazz;\r\n      }\r\n    }\r\n\r\n    return Clazz;\r\n  };\r\n\r\n  entity.getClass = function (componentMainType, subType, throwWhenNotFound) {\r\n    var Clazz = storage[componentMainType];\r\n\r\n    if (Clazz && Clazz[IS_CONTAINER]) {\r\n      Clazz = subType ? Clazz[subType] : null;\r\n    }\r\n\r\n    if (throwWhenNotFound && !Clazz) {\r\n      throw new Error(!subType ? componentMainType + '.' + 'type should be specified.' : 'Component ' + componentMainType + '.' + (subType || '') + ' not exists. Load it first.');\r\n    }\r\n\r\n    return Clazz;\r\n  };\r\n\r\n  entity.getClassesByMainType = function (componentType) {\r\n    componentType = parseClassType(componentType);\r\n    var result = [];\r\n    var obj = storage[componentType.main];\r\n\r\n    if (obj && obj[IS_CONTAINER]) {\r\n      zrUtil.each(obj, function (o, type) {\r\n        type !== IS_CONTAINER && result.push(o);\r\n      });\r\n    } else {\r\n      result.push(obj);\r\n    }\r\n\r\n    return result;\r\n  };\r\n\r\n  entity.hasClass = function (componentType) {\r\n    // Just consider componentType.main.\r\n    componentType = parseClassType(componentType);\r\n    return !!storage[componentType.main];\r\n  };\r\n  /**\r\n   * @return {Array.<string>} Like ['aa', 'bb'], but can not be ['aa.xx']\r\n   */\r\n\r\n\r\n  entity.getAllClassMainTypes = function () {\r\n    var types = [];\r\n    zrUtil.each(storage, function (obj, type) {\r\n      types.push(type);\r\n    });\r\n    return types;\r\n  };\r\n  /**\r\n   * If a main type is container and has sub types\r\n   * @param  {string}  mainType\r\n   * @return {boolean}\r\n   */\r\n\r\n\r\n  entity.hasSubTypes = function (componentType) {\r\n    componentType = parseClassType(componentType);\r\n    var obj = storage[componentType.main];\r\n    return obj && obj[IS_CONTAINER];\r\n  };\r\n\r\n  entity.parseClassType = parseClassType;\r\n\r\n  function makeContainer(componentType) {\r\n    var container = storage[componentType.main];\r\n\r\n    if (!container || !container[IS_CONTAINER]) {\r\n      container = storage[componentType.main] = {};\r\n      container[IS_CONTAINER] = true;\r\n    }\r\n\r\n    return container;\r\n  }\r\n\r\n  if (options.registerWhenExtend) {\r\n    var originalExtend = entity.extend;\r\n\r\n    if (originalExtend) {\r\n      entity.extend = function (proto) {\r\n        var ExtendedClass = originalExtend.call(this, proto);\r\n        return entity.registerClass(ExtendedClass, proto.type);\r\n      };\r\n    }\r\n  }\r\n\r\n  return entity;\r\n}\r\n/**\r\n * @param {string|Array.<string>} properties\r\n */\r\n\r\n\r\nfunction setReadOnly(obj, properties) {// FIXME It seems broken in IE8 simulation of IE11\r\n  // if (!zrUtil.isArray(properties)) {\r\n  //     properties = properties != null ? [properties] : [];\r\n  // }\r\n  // zrUtil.each(properties, function (prop) {\r\n  //     var value = obj[prop];\r\n  //     Object.defineProperty\r\n  //         && Object.defineProperty(obj, prop, {\r\n  //             value: value, writable: false\r\n  //         });\r\n  //     zrUtil.isArray(obj[prop])\r\n  //         && Object.freeze\r\n  //         && Object.freeze(obj[prop]);\r\n  // });\r\n}\r\n\r\nexports.parseClassType = parseClassType;\r\nexports.enableClassExtend = enableClassExtend;\r\nexports.enableClassCheck = enableClassCheck;\r\nexports.enableClassManagement = enableClassManagement;\r\nexports.setReadOnly = setReadOnly;"]},"metadata":{},"sourceType":"script"}