{"ast":null,"code":"var __assign = this && this.__assign || function () {\n  __assign = Object.assign || function (t) {\n    for (var s, i = 1, n = arguments.length; i < n; i++) {\n      s = arguments[i];\n\n      for (var p in s) {\n        if (Object.prototype.hasOwnProperty.call(s, p)) t[p] = s[p];\n      }\n    }\n\n    return t;\n  };\n\n  return __assign.apply(this, arguments);\n};\n\nvar __spreadArrays = this && this.__spreadArrays || function () {\n  for (var s = 0, i = 0, il = arguments.length; i < il; i++) {\n    s += arguments[i].length;\n  }\n\n  for (var r = Array(s), k = 0, i = 0; i < il; i++) {\n    for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++) {\n      r[k] = a[j];\n    }\n  }\n\n  return r;\n};\n\nexport var DAYS_OF_WEEK;\n\n(function (DAYS_OF_WEEK) {\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"SUNDAY\"] = 0] = \"SUNDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"MONDAY\"] = 1] = \"MONDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"TUESDAY\"] = 2] = \"TUESDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"WEDNESDAY\"] = 3] = \"WEDNESDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"THURSDAY\"] = 4] = \"THURSDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"FRIDAY\"] = 5] = \"FRIDAY\";\n  DAYS_OF_WEEK[DAYS_OF_WEEK[\"SATURDAY\"] = 6] = \"SATURDAY\";\n})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));\n\nvar DEFAULT_WEEKEND_DAYS = [DAYS_OF_WEEK.SUNDAY, DAYS_OF_WEEK.SATURDAY];\nvar DAYS_IN_WEEK = 7;\nvar HOURS_IN_DAY = 24;\nvar MINUTES_IN_HOUR = 60;\nexport var SECONDS_IN_DAY = 60 * 60 * 24;\n\nfunction getExcludedSeconds(dateAdapter, _a) {\n  var startDate = _a.startDate,\n      seconds = _a.seconds,\n      excluded = _a.excluded,\n      precision = _a.precision;\n\n  if (excluded.length < 1) {\n    return 0;\n  }\n\n  var addSeconds = dateAdapter.addSeconds,\n      getDay = dateAdapter.getDay,\n      addDays = dateAdapter.addDays;\n  var endDate = addSeconds(startDate, seconds - 1);\n  var dayStart = getDay(startDate);\n  var dayEnd = getDay(endDate);\n  var result = 0; // Calculated in seconds\n\n  var current = startDate;\n\n  var _loop_1 = function _loop_1() {\n    var day = getDay(current);\n\n    if (excluded.some(function (excludedDay) {\n      return excludedDay === day;\n    })) {\n      result += calculateExcludedSeconds(dateAdapter, {\n        dayStart: dayStart,\n        dayEnd: dayEnd,\n        day: day,\n        precision: precision,\n        startDate: startDate,\n        endDate: endDate\n      });\n    }\n\n    current = addDays(current, 1);\n  };\n\n  while (current < endDate) {\n    _loop_1();\n  }\n\n  return result;\n}\n\nfunction calculateExcludedSeconds(dateAdapter, _a) {\n  var precision = _a.precision,\n      day = _a.day,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      startDate = _a.startDate,\n      endDate = _a.endDate;\n  var differenceInSeconds = dateAdapter.differenceInSeconds,\n      endOfDay = dateAdapter.endOfDay,\n      startOfDay = dateAdapter.startOfDay;\n\n  if (precision === 'minutes') {\n    if (day === dayStart) {\n      return differenceInSeconds(endOfDay(startDate), startDate) + 1;\n    } else if (day === dayEnd) {\n      return differenceInSeconds(endDate, startOfDay(endDate)) + 1;\n    }\n  }\n\n  return SECONDS_IN_DAY;\n}\n\nfunction getWeekViewEventSpan(dateAdapter, _a) {\n  var event = _a.event,\n      offset = _a.offset,\n      startOfWeekDate = _a.startOfWeekDate,\n      excluded = _a.excluded,\n      precision = _a.precision,\n      totalDaysInView = _a.totalDaysInView;\n  var max = dateAdapter.max,\n      differenceInSeconds = dateAdapter.differenceInSeconds,\n      addDays = dateAdapter.addDays,\n      endOfDay = dateAdapter.endOfDay,\n      differenceInDays = dateAdapter.differenceInDays;\n  var span = SECONDS_IN_DAY;\n  var begin = max([event.start, startOfWeekDate]);\n\n  if (event.end) {\n    switch (precision) {\n      case 'minutes':\n        span = differenceInSeconds(event.end, begin);\n        break;\n\n      default:\n        span = differenceInDays(addDays(endOfDay(event.end), 1), begin) * SECONDS_IN_DAY;\n        break;\n    }\n  }\n\n  var offsetSeconds = offset * SECONDS_IN_DAY;\n  var totalLength = offsetSeconds + span; // the best way to detect if an event is outside the week-view\n  // is to check if the total span beginning (from startOfWeekDay or event start) exceeds the total days in the view\n\n  var secondsInView = totalDaysInView * SECONDS_IN_DAY;\n\n  if (totalLength > secondsInView) {\n    span = secondsInView - offsetSeconds;\n  }\n\n  span -= getExcludedSeconds(dateAdapter, {\n    startDate: begin,\n    seconds: span,\n    excluded: excluded,\n    precision: precision\n  });\n  return span / SECONDS_IN_DAY;\n}\n\nfunction getWeekViewEventOffset(dateAdapter, _a) {\n  var event = _a.event,\n      startOfWeekDate = _a.startOfWeek,\n      excluded = _a.excluded,\n      precision = _a.precision;\n  var differenceInDays = dateAdapter.differenceInDays,\n      startOfDay = dateAdapter.startOfDay,\n      differenceInSeconds = dateAdapter.differenceInSeconds;\n\n  if (event.start < startOfWeekDate) {\n    return 0;\n  }\n\n  var offset = 0;\n\n  switch (precision) {\n    case 'days':\n      offset = differenceInDays(startOfDay(event.start), startOfWeekDate) * SECONDS_IN_DAY;\n      break;\n\n    case 'minutes':\n      offset = differenceInSeconds(event.start, startOfWeekDate);\n      break;\n  }\n\n  offset -= getExcludedSeconds(dateAdapter, {\n    startDate: startOfWeekDate,\n    seconds: offset,\n    excluded: excluded,\n    precision: precision\n  });\n  return Math.abs(offset / SECONDS_IN_DAY);\n}\n\nfunction isEventIsPeriod(dateAdapter, _a) {\n  var event = _a.event,\n      periodStart = _a.periodStart,\n      periodEnd = _a.periodEnd;\n  var isSameSecond = dateAdapter.isSameSecond;\n  var eventStart = event.start;\n  var eventEnd = event.end || event.start;\n\n  if (eventStart > periodStart && eventStart < periodEnd) {\n    return true;\n  }\n\n  if (eventEnd > periodStart && eventEnd < periodEnd) {\n    return true;\n  }\n\n  if (eventStart < periodStart && eventEnd > periodEnd) {\n    return true;\n  }\n\n  if (isSameSecond(eventStart, periodStart) || isSameSecond(eventStart, periodEnd)) {\n    return true;\n  }\n\n  if (isSameSecond(eventEnd, periodStart) || isSameSecond(eventEnd, periodEnd)) {\n    return true;\n  }\n\n  return false;\n}\n\nexport function getEventsInPeriod(dateAdapter, _a) {\n  var events = _a.events,\n      periodStart = _a.periodStart,\n      periodEnd = _a.periodEnd;\n  return events.filter(function (event) {\n    return isEventIsPeriod(dateAdapter, {\n      event: event,\n      periodStart: periodStart,\n      periodEnd: periodEnd\n    });\n  });\n}\n\nfunction getWeekDay(dateAdapter, _a) {\n  var date = _a.date,\n      _b = _a.weekendDays,\n      weekendDays = _b === void 0 ? DEFAULT_WEEKEND_DAYS : _b;\n  var startOfDay = dateAdapter.startOfDay,\n      isSameDay = dateAdapter.isSameDay,\n      getDay = dateAdapter.getDay;\n  var today = startOfDay(new Date());\n  var day = getDay(date);\n  return {\n    date: date,\n    day: day,\n    isPast: date < today,\n    isToday: isSameDay(date, today),\n    isFuture: date > today,\n    isWeekend: weekendDays.indexOf(day) > -1\n  };\n}\n\nexport function getWeekViewHeader(dateAdapter, _a) {\n  var viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _b = _a.excluded,\n      excluded = _b === void 0 ? [] : _b,\n      weekendDays = _a.weekendDays,\n      _c = _a.viewStart,\n      viewStart = _c === void 0 ? dateAdapter.startOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  }) : _c,\n      _d = _a.viewEnd,\n      viewEnd = _d === void 0 ? dateAdapter.addDays(viewStart, DAYS_IN_WEEK) : _d;\n  var addDays = dateAdapter.addDays,\n      getDay = dateAdapter.getDay;\n  var days = [];\n  var date = viewStart;\n\n  while (date < viewEnd) {\n    if (!excluded.some(function (e) {\n      return getDay(date) === e;\n    })) {\n      days.push(getWeekDay(dateAdapter, {\n        date: date,\n        weekendDays: weekendDays\n      }));\n    }\n\n    date = addDays(date, 1);\n  }\n\n  return days;\n}\nexport function getDifferenceInDaysWithExclusions(dateAdapter, _a) {\n  var date1 = _a.date1,\n      date2 = _a.date2,\n      excluded = _a.excluded;\n  var date = date1;\n  var diff = 0;\n\n  while (date < date2) {\n    if (excluded.indexOf(dateAdapter.getDay(date)) === -1) {\n      diff++;\n    }\n\n    date = dateAdapter.addDays(date, 1);\n  }\n\n  return diff;\n}\nexport function getAllDayWeekEvents(dateAdapter, _a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      _c = _a.excluded,\n      excluded = _c === void 0 ? [] : _c,\n      _d = _a.precision,\n      precision = _d === void 0 ? 'days' : _d,\n      _e = _a.absolutePositionedEvents,\n      absolutePositionedEvents = _e === void 0 ? false : _e,\n      viewStart = _a.viewStart,\n      viewEnd = _a.viewEnd;\n  viewStart = dateAdapter.startOfDay(viewStart);\n  viewEnd = dateAdapter.endOfDay(viewEnd);\n  var differenceInSeconds = dateAdapter.differenceInSeconds,\n      differenceInDays = dateAdapter.differenceInDays;\n  var maxRange = getDifferenceInDaysWithExclusions(dateAdapter, {\n    date1: viewStart,\n    date2: viewEnd,\n    excluded: excluded\n  });\n  var totalDaysInView = differenceInDays(viewEnd, viewStart) + 1;\n  var eventsMapped = events.filter(function (event) {\n    return event.allDay;\n  }).map(function (event) {\n    var offset = getWeekViewEventOffset(dateAdapter, {\n      event: event,\n      startOfWeek: viewStart,\n      excluded: excluded,\n      precision: precision\n    });\n    var span = getWeekViewEventSpan(dateAdapter, {\n      event: event,\n      offset: offset,\n      startOfWeekDate: viewStart,\n      excluded: excluded,\n      precision: precision,\n      totalDaysInView: totalDaysInView\n    });\n    return {\n      event: event,\n      offset: offset,\n      span: span\n    };\n  }).filter(function (e) {\n    return e.offset < maxRange;\n  }).filter(function (e) {\n    return e.span > 0;\n  }).map(function (entry) {\n    return {\n      event: entry.event,\n      offset: entry.offset,\n      span: entry.span,\n      startsBeforeWeek: entry.event.start < viewStart,\n      endsAfterWeek: (entry.event.end || entry.event.start) > viewEnd\n    };\n  }).sort(function (itemA, itemB) {\n    var startSecondsDiff = differenceInSeconds(itemA.event.start, itemB.event.start);\n\n    if (startSecondsDiff === 0) {\n      return differenceInSeconds(itemB.event.end || itemB.event.start, itemA.event.end || itemA.event.start);\n    }\n\n    return startSecondsDiff;\n  });\n  var allDayEventRows = [];\n  var allocatedEvents = [];\n  eventsMapped.forEach(function (event, index) {\n    if (allocatedEvents.indexOf(event) === -1) {\n      allocatedEvents.push(event);\n      var rowSpan_1 = event.span + event.offset;\n      var otherRowEvents = eventsMapped.slice(index + 1).filter(function (nextEvent) {\n        if (nextEvent.offset >= rowSpan_1 && rowSpan_1 + nextEvent.span <= totalDaysInView && allocatedEvents.indexOf(nextEvent) === -1) {\n          var nextEventOffset = nextEvent.offset - rowSpan_1;\n\n          if (!absolutePositionedEvents) {\n            nextEvent.offset = nextEventOffset;\n          }\n\n          rowSpan_1 += nextEvent.span + nextEventOffset;\n          allocatedEvents.push(nextEvent);\n          return true;\n        }\n      });\n\n      var weekEvents = __spreadArrays([event], otherRowEvents);\n\n      var id = weekEvents.filter(function (weekEvent) {\n        return weekEvent.event.id;\n      }).map(function (weekEvent) {\n        return weekEvent.event.id;\n      }).join('-');\n      allDayEventRows.push(__assign({\n        row: weekEvents\n      }, id ? {\n        id: id\n      } : {}));\n    }\n  });\n  return allDayEventRows;\n}\n\nfunction getWeekViewHourGrid(dateAdapter, _a) {\n  var events = _a.events,\n      viewDate = _a.viewDate,\n      hourSegments = _a.hourSegments,\n      hourDuration = _a.hourDuration,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      weekStartsOn = _a.weekStartsOn,\n      excluded = _a.excluded,\n      weekendDays = _a.weekendDays,\n      segmentHeight = _a.segmentHeight,\n      viewStart = _a.viewStart,\n      viewEnd = _a.viewEnd,\n      minimumEventHeight = _a.minimumEventHeight;\n  var dayViewHourGrid = getDayViewHourGrid(dateAdapter, {\n    viewDate: viewDate,\n    hourSegments: hourSegments,\n    hourDuration: hourDuration,\n    dayStart: dayStart,\n    dayEnd: dayEnd\n  });\n  var weekDays = getWeekViewHeader(dateAdapter, {\n    viewDate: viewDate,\n    weekStartsOn: weekStartsOn,\n    excluded: excluded,\n    weekendDays: weekendDays,\n    viewStart: viewStart,\n    viewEnd: viewEnd\n  });\n  var setHours = dateAdapter.setHours,\n      setMinutes = dateAdapter.setMinutes,\n      getHours = dateAdapter.getHours,\n      getMinutes = dateAdapter.getMinutes;\n  return weekDays.map(function (day) {\n    var dayView = getDayView(dateAdapter, {\n      events: events,\n      viewDate: day.date,\n      hourSegments: hourSegments,\n      dayStart: dayStart,\n      dayEnd: dayEnd,\n      segmentHeight: segmentHeight,\n      eventWidth: 1,\n      hourDuration: hourDuration,\n      minimumEventHeight: minimumEventHeight\n    });\n    var hours = dayViewHourGrid.map(function (hour) {\n      var segments = hour.segments.map(function (segment) {\n        var date = setMinutes(setHours(day.date, getHours(segment.date)), getMinutes(segment.date));\n        return __assign(__assign({}, segment), {\n          date: date\n        });\n      });\n      return __assign(__assign({}, hour), {\n        segments: segments\n      });\n    });\n\n    function getColumnCount(allEvents, prevOverlappingEvents) {\n      var columnCount = Math.max.apply(Math, prevOverlappingEvents.map(function (iEvent) {\n        return iEvent.left + 1;\n      }));\n      var nextOverlappingEvents = allEvents.filter(function (iEvent) {\n        return iEvent.left >= columnCount;\n      }).filter(function (iEvent) {\n        return getOverLappingWeekViewEvents(prevOverlappingEvents, iEvent.top, iEvent.top + iEvent.height).length > 0;\n      });\n\n      if (nextOverlappingEvents.length > 0) {\n        return getColumnCount(allEvents, nextOverlappingEvents);\n      } else {\n        return columnCount;\n      }\n    }\n\n    var mappedEvents = dayView.events.map(function (event) {\n      var columnCount = getColumnCount(dayView.events, getOverLappingWeekViewEvents(dayView.events, event.top, event.top + event.height));\n      var width = 100 / columnCount;\n      return __assign(__assign({}, event), {\n        left: event.left * width,\n        width: width\n      });\n    });\n    return {\n      hours: hours,\n      date: day.date,\n      events: mappedEvents.map(function (event) {\n        var overLappingEvents = getOverLappingWeekViewEvents(mappedEvents.filter(function (otherEvent) {\n          return otherEvent.left > event.left;\n        }), event.top, event.top + event.height);\n\n        if (overLappingEvents.length > 0) {\n          return __assign(__assign({}, event), {\n            width: Math.min.apply(Math, overLappingEvents.map(function (otherEvent) {\n              return otherEvent.left;\n            })) - event.left\n          });\n        }\n\n        return event;\n      })\n    };\n  });\n}\n\nexport function getWeekView(dateAdapter, _a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _c = _a.excluded,\n      excluded = _c === void 0 ? [] : _c,\n      _d = _a.precision,\n      precision = _d === void 0 ? 'days' : _d,\n      _e = _a.absolutePositionedEvents,\n      absolutePositionedEvents = _e === void 0 ? false : _e,\n      hourSegments = _a.hourSegments,\n      hourDuration = _a.hourDuration,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      weekendDays = _a.weekendDays,\n      segmentHeight = _a.segmentHeight,\n      minimumEventHeight = _a.minimumEventHeight,\n      _f = _a.viewStart,\n      viewStart = _f === void 0 ? dateAdapter.startOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  }) : _f,\n      _g = _a.viewEnd,\n      viewEnd = _g === void 0 ? dateAdapter.endOfWeek(viewDate, {\n    weekStartsOn: weekStartsOn\n  }) : _g;\n\n  if (!events) {\n    events = [];\n  }\n\n  var startOfDay = dateAdapter.startOfDay,\n      endOfDay = dateAdapter.endOfDay;\n  viewStart = startOfDay(viewStart);\n  viewEnd = endOfDay(viewEnd);\n  var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n    events: events,\n    periodStart: viewStart,\n    periodEnd: viewEnd\n  });\n  var header = getWeekViewHeader(dateAdapter, {\n    viewDate: viewDate,\n    weekStartsOn: weekStartsOn,\n    excluded: excluded,\n    weekendDays: weekendDays,\n    viewStart: viewStart,\n    viewEnd: viewEnd\n  });\n  return {\n    allDayEventRows: getAllDayWeekEvents(dateAdapter, {\n      events: eventsInPeriod,\n      excluded: excluded,\n      precision: precision,\n      absolutePositionedEvents: absolutePositionedEvents,\n      viewStart: viewStart,\n      viewEnd: viewEnd\n    }),\n    period: {\n      events: eventsInPeriod,\n      start: header[0].date,\n      end: endOfDay(header[header.length - 1].date)\n    },\n    hourColumns: getWeekViewHourGrid(dateAdapter, {\n      events: events,\n      viewDate: viewDate,\n      hourSegments: hourSegments,\n      hourDuration: hourDuration,\n      dayStart: dayStart,\n      dayEnd: dayEnd,\n      weekStartsOn: weekStartsOn,\n      excluded: excluded,\n      weekendDays: weekendDays,\n      segmentHeight: segmentHeight,\n      viewStart: viewStart,\n      viewEnd: viewEnd,\n      minimumEventHeight: minimumEventHeight\n    })\n  };\n}\nexport function getMonthView(dateAdapter, _a) {\n  var _b = _a.events,\n      events = _b === void 0 ? [] : _b,\n      viewDate = _a.viewDate,\n      weekStartsOn = _a.weekStartsOn,\n      _c = _a.excluded,\n      excluded = _c === void 0 ? [] : _c,\n      _d = _a.viewStart,\n      viewStart = _d === void 0 ? dateAdapter.startOfMonth(viewDate) : _d,\n      _e = _a.viewEnd,\n      viewEnd = _e === void 0 ? dateAdapter.endOfMonth(viewDate) : _e,\n      weekendDays = _a.weekendDays;\n\n  if (!events) {\n    events = [];\n  }\n\n  var startOfWeek = dateAdapter.startOfWeek,\n      endOfWeek = dateAdapter.endOfWeek,\n      differenceInDays = dateAdapter.differenceInDays,\n      startOfDay = dateAdapter.startOfDay,\n      addHours = dateAdapter.addHours,\n      endOfDay = dateAdapter.endOfDay,\n      isSameMonth = dateAdapter.isSameMonth,\n      getDay = dateAdapter.getDay,\n      getMonth = dateAdapter.getMonth;\n  var start = startOfWeek(viewStart, {\n    weekStartsOn: weekStartsOn\n  });\n  var end = endOfWeek(viewEnd, {\n    weekStartsOn: weekStartsOn\n  });\n  var eventsInMonth = getEventsInPeriod(dateAdapter, {\n    events: events,\n    periodStart: start,\n    periodEnd: end\n  });\n  var initialViewDays = [];\n  var previousDate;\n\n  var _loop_2 = function _loop_2(i) {\n    // hacky fix for https://github.com/mattlewis92/angular-calendar/issues/173\n    var date;\n\n    if (previousDate) {\n      date = startOfDay(addHours(previousDate, HOURS_IN_DAY));\n\n      if (previousDate.getTime() === date.getTime()) {\n        // DST change, so need to add 25 hours\n\n        /* istanbul ignore next */\n        date = startOfDay(addHours(previousDate, HOURS_IN_DAY + 1));\n      }\n\n      previousDate = date;\n    } else {\n      date = previousDate = start;\n    }\n\n    if (!excluded.some(function (e) {\n      return getDay(date) === e;\n    })) {\n      var day = getWeekDay(dateAdapter, {\n        date: date,\n        weekendDays: weekendDays\n      });\n      var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n        events: eventsInMonth,\n        periodStart: startOfDay(date),\n        periodEnd: endOfDay(date)\n      });\n      day.inMonth = isSameMonth(date, viewDate);\n      day.events = eventsInPeriod;\n      day.badgeTotal = eventsInPeriod.length;\n      initialViewDays.push(day);\n    }\n  };\n\n  for (var i = 0; i < differenceInDays(end, start) + 1; i++) {\n    _loop_2(i);\n  }\n\n  var days = [];\n  var totalDaysVisibleInWeek = DAYS_IN_WEEK - excluded.length;\n\n  if (totalDaysVisibleInWeek < DAYS_IN_WEEK) {\n    for (var i = 0; i < initialViewDays.length; i += totalDaysVisibleInWeek) {\n      var row = initialViewDays.slice(i, i + totalDaysVisibleInWeek);\n      var isRowInMonth = row.some(function (day) {\n        return viewStart <= day.date && day.date < viewEnd;\n      });\n\n      if (isRowInMonth) {\n        days = __spreadArrays(days, row);\n      }\n    }\n  } else {\n    days = initialViewDays;\n  }\n\n  var rows = Math.floor(days.length / totalDaysVisibleInWeek);\n  var rowOffsets = [];\n\n  for (var i = 0; i < rows; i++) {\n    rowOffsets.push(i * totalDaysVisibleInWeek);\n  }\n\n  return {\n    rowOffsets: rowOffsets,\n    totalDaysVisibleInWeek: totalDaysVisibleInWeek,\n    days: days,\n    period: {\n      start: days[0].date,\n      end: endOfDay(days[days.length - 1].date),\n      events: eventsInMonth\n    }\n  };\n}\n\nfunction getOverLappingWeekViewEvents(events, top, bottom) {\n  return events.filter(function (previousEvent) {\n    var previousEventTop = previousEvent.top;\n    var previousEventBottom = previousEvent.top + previousEvent.height;\n\n    if (top < previousEventBottom && previousEventBottom < bottom) {\n      return true;\n    } else if (top < previousEventTop && previousEventTop < bottom) {\n      return true;\n    } else if (previousEventTop <= top && bottom <= previousEventBottom) {\n      return true;\n    }\n\n    return false;\n  });\n}\n\nfunction getDayView(dateAdapter, _a) {\n  var events = _a.events,\n      viewDate = _a.viewDate,\n      hourSegments = _a.hourSegments,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd,\n      eventWidth = _a.eventWidth,\n      segmentHeight = _a.segmentHeight,\n      hourDuration = _a.hourDuration,\n      minimumEventHeight = _a.minimumEventHeight;\n  var setMinutes = dateAdapter.setMinutes,\n      setHours = dateAdapter.setHours,\n      startOfDay = dateAdapter.startOfDay,\n      startOfMinute = dateAdapter.startOfMinute,\n      endOfDay = dateAdapter.endOfDay,\n      differenceInMinutes = dateAdapter.differenceInMinutes;\n  var startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));\n  var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));\n  endOfView.setSeconds(59, 999);\n  var previousDayEvents = [];\n  var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n    events: events.filter(function (event) {\n      return !event.allDay;\n    }),\n    periodStart: startOfView,\n    periodEnd: endOfView\n  });\n  var dayViewEvents = eventsInPeriod.sort(function (eventA, eventB) {\n    return eventA.start.valueOf() - eventB.start.valueOf();\n  }).map(function (event) {\n    var eventStart = event.start;\n    var eventEnd = event.end || eventStart;\n    var startsBeforeDay = eventStart < startOfView;\n    var endsAfterDay = eventEnd > endOfView;\n    var hourHeightModifier = hourSegments * segmentHeight / (hourDuration || MINUTES_IN_HOUR);\n    var top = 0;\n\n    if (eventStart > startOfView) {\n      // adjust the difference in minutes if the user's offset is different between the start of the day and the event (e.g. when going to or from DST)\n      var eventOffset = eventStart.getTimezoneOffset();\n      var startOffset = startOfView.getTimezoneOffset();\n      var diff = startOffset - eventOffset;\n      top += differenceInMinutes(eventStart, startOfView) + diff;\n    }\n\n    top *= hourHeightModifier;\n    var startDate = startsBeforeDay ? startOfView : eventStart;\n    var endDate = endsAfterDay ? endOfView : eventEnd;\n    var timezoneOffset = startDate.getTimezoneOffset() - endDate.getTimezoneOffset();\n    var height = differenceInMinutes(endDate, startDate) + timezoneOffset;\n\n    if (!event.end) {\n      height = segmentHeight;\n    } else {\n      height *= hourHeightModifier;\n    }\n\n    if (minimumEventHeight && height < minimumEventHeight) {\n      height = minimumEventHeight;\n    }\n\n    var bottom = top + height;\n    var overlappingPreviousEvents = getOverLappingWeekViewEvents(previousDayEvents, top, bottom);\n    var left = 0;\n\n    while (overlappingPreviousEvents.some(function (previousEvent) {\n      return previousEvent.left === left;\n    })) {\n      left += eventWidth;\n    }\n\n    var dayEvent = {\n      event: event,\n      height: height,\n      width: eventWidth,\n      top: top,\n      left: left,\n      startsBeforeDay: startsBeforeDay,\n      endsAfterDay: endsAfterDay\n    };\n    previousDayEvents.push(dayEvent);\n    return dayEvent;\n  });\n  var width = Math.max.apply(Math, dayViewEvents.map(function (event) {\n    return event.left + event.width;\n  }));\n  var allDayEvents = getEventsInPeriod(dateAdapter, {\n    events: events.filter(function (event) {\n      return event.allDay;\n    }),\n    periodStart: startOfDay(startOfView),\n    periodEnd: endOfDay(endOfView)\n  });\n  return {\n    events: dayViewEvents,\n    width: width,\n    allDayEvents: allDayEvents,\n    period: {\n      events: eventsInPeriod,\n      start: startOfView,\n      end: endOfView\n    }\n  };\n}\n\nfunction sanitiseHours(hours) {\n  return Math.max(Math.min(23, hours), 0);\n}\n\nfunction sanitiseMinutes(minutes) {\n  return Math.max(Math.min(59, minutes), 0);\n}\n\nfunction getDayViewHourGrid(dateAdapter, _a) {\n  var viewDate = _a.viewDate,\n      hourSegments = _a.hourSegments,\n      hourDuration = _a.hourDuration,\n      dayStart = _a.dayStart,\n      dayEnd = _a.dayEnd;\n  var setMinutes = dateAdapter.setMinutes,\n      setHours = dateAdapter.setHours,\n      startOfDay = dateAdapter.startOfDay,\n      startOfMinute = dateAdapter.startOfMinute,\n      endOfDay = dateAdapter.endOfDay,\n      addMinutes = dateAdapter.addMinutes,\n      addHours = dateAdapter.addHours,\n      addDays = dateAdapter.addDays;\n  var hours = [];\n  var startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));\n  var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));\n  var segmentDuration = (hourDuration || MINUTES_IN_HOUR) / hourSegments;\n  var startOfViewDay = startOfDay(viewDate);\n  var endOfViewDay = endOfDay(viewDate);\n\n  var dateAdjustment = function dateAdjustment(d) {\n    return d;\n  }; // this means that we change from or to DST on this day and that's going to cause problems so we bump the date\n\n\n  if (startOfViewDay.getTimezoneOffset() !== endOfViewDay.getTimezoneOffset()) {\n    startOfViewDay = addDays(startOfViewDay, 1);\n    startOfView = addDays(startOfView, 1);\n    endOfView = addDays(endOfView, 1);\n\n    dateAdjustment = function dateAdjustment(d) {\n      return addDays(d, -1);\n    };\n  }\n\n  var dayDuration = hourDuration ? HOURS_IN_DAY * 60 / hourDuration : MINUTES_IN_HOUR;\n\n  for (var i = 0; i < dayDuration; i++) {\n    var segments = [];\n\n    for (var j = 0; j < hourSegments; j++) {\n      var date = addMinutes(addMinutes(startOfView, i * (hourDuration || MINUTES_IN_HOUR)), j * segmentDuration);\n\n      if (date >= startOfView && date < endOfView) {\n        segments.push({\n          date: dateAdjustment(date),\n          displayDate: date,\n          isStart: j === 0\n        });\n      }\n    }\n\n    if (segments.length > 0) {\n      hours.push({\n        segments: segments\n      });\n    }\n  }\n\n  return hours;\n}\n\nexport var EventValidationErrorMessage;\n\n(function (EventValidationErrorMessage) {\n  EventValidationErrorMessage[\"NotArray\"] = \"Events must be an array\";\n  EventValidationErrorMessage[\"StartPropertyMissing\"] = \"Event is missing the `start` property\";\n  EventValidationErrorMessage[\"StartPropertyNotDate\"] = \"Event `start` property should be a javascript date object. Do `new Date(event.start)` to fix it.\";\n  EventValidationErrorMessage[\"EndPropertyNotDate\"] = \"Event `end` property should be a javascript date object. Do `new Date(event.end)` to fix it.\";\n  EventValidationErrorMessage[\"EndsBeforeStart\"] = \"Event `start` property occurs after the `end`\";\n})(EventValidationErrorMessage || (EventValidationErrorMessage = {}));\n\nexport function validateEvents(events, log) {\n  var isValid = true;\n\n  function isError(msg, event) {\n    log(msg, event);\n    isValid = false;\n  }\n\n  if (!Array.isArray(events)) {\n    log(EventValidationErrorMessage.NotArray, events);\n    return false;\n  }\n\n  events.forEach(function (event) {\n    if (!event.start) {\n      isError(EventValidationErrorMessage.StartPropertyMissing, event);\n    } else if (!(event.start instanceof Date)) {\n      isError(EventValidationErrorMessage.StartPropertyNotDate, event);\n    }\n\n    if (event.end) {\n      if (!(event.end instanceof Date)) {\n        isError(EventValidationErrorMessage.EndPropertyNotDate, event);\n      }\n\n      if (event.start > event.end) {\n        isError(EventValidationErrorMessage.EndsBeforeStart, event);\n      }\n    }\n  });\n  return isValid;\n}","map":{"version":3,"sources":["../src/calendar-utils.ts"],"names":[],"mappings":"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","sourceRoot":"","sourcesContent":["var __assign = (this && this.__assign) || function () {\n    __assign = Object.assign || function(t) {\n        for (var s, i = 1, n = arguments.length; i < n; i++) {\n            s = arguments[i];\n            for (var p in s) if (Object.prototype.hasOwnProperty.call(s, p))\n                t[p] = s[p];\n        }\n        return t;\n    };\n    return __assign.apply(this, arguments);\n};\nvar __spreadArrays = (this && this.__spreadArrays) || function () {\n    for (var s = 0, i = 0, il = arguments.length; i < il; i++) s += arguments[i].length;\n    for (var r = Array(s), k = 0, i = 0; i < il; i++)\n        for (var a = arguments[i], j = 0, jl = a.length; j < jl; j++, k++)\n            r[k] = a[j];\n    return r;\n};\nexport var DAYS_OF_WEEK;\n(function (DAYS_OF_WEEK) {\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"SUNDAY\"] = 0] = \"SUNDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"MONDAY\"] = 1] = \"MONDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"TUESDAY\"] = 2] = \"TUESDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"WEDNESDAY\"] = 3] = \"WEDNESDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"THURSDAY\"] = 4] = \"THURSDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"FRIDAY\"] = 5] = \"FRIDAY\";\n    DAYS_OF_WEEK[DAYS_OF_WEEK[\"SATURDAY\"] = 6] = \"SATURDAY\";\n})(DAYS_OF_WEEK || (DAYS_OF_WEEK = {}));\nvar DEFAULT_WEEKEND_DAYS = [\n    DAYS_OF_WEEK.SUNDAY,\n    DAYS_OF_WEEK.SATURDAY,\n];\nvar DAYS_IN_WEEK = 7;\nvar HOURS_IN_DAY = 24;\nvar MINUTES_IN_HOUR = 60;\nexport var SECONDS_IN_DAY = 60 * 60 * 24;\nfunction getExcludedSeconds(dateAdapter, _a) {\n    var startDate = _a.startDate, seconds = _a.seconds, excluded = _a.excluded, precision = _a.precision;\n    if (excluded.length < 1) {\n        return 0;\n    }\n    var addSeconds = dateAdapter.addSeconds, getDay = dateAdapter.getDay, addDays = dateAdapter.addDays;\n    var endDate = addSeconds(startDate, seconds - 1);\n    var dayStart = getDay(startDate);\n    var dayEnd = getDay(endDate);\n    var result = 0; // Calculated in seconds\n    var current = startDate;\n    var _loop_1 = function () {\n        var day = getDay(current);\n        if (excluded.some(function (excludedDay) { return excludedDay === day; })) {\n            result += calculateExcludedSeconds(dateAdapter, {\n                dayStart: dayStart,\n                dayEnd: dayEnd,\n                day: day,\n                precision: precision,\n                startDate: startDate,\n                endDate: endDate,\n            });\n        }\n        current = addDays(current, 1);\n    };\n    while (current < endDate) {\n        _loop_1();\n    }\n    return result;\n}\nfunction calculateExcludedSeconds(dateAdapter, _a) {\n    var precision = _a.precision, day = _a.day, dayStart = _a.dayStart, dayEnd = _a.dayEnd, startDate = _a.startDate, endDate = _a.endDate;\n    var differenceInSeconds = dateAdapter.differenceInSeconds, endOfDay = dateAdapter.endOfDay, startOfDay = dateAdapter.startOfDay;\n    if (precision === 'minutes') {\n        if (day === dayStart) {\n            return differenceInSeconds(endOfDay(startDate), startDate) + 1;\n        }\n        else if (day === dayEnd) {\n            return differenceInSeconds(endDate, startOfDay(endDate)) + 1;\n        }\n    }\n    return SECONDS_IN_DAY;\n}\nfunction getWeekViewEventSpan(dateAdapter, _a) {\n    var event = _a.event, offset = _a.offset, startOfWeekDate = _a.startOfWeekDate, excluded = _a.excluded, precision = _a.precision, totalDaysInView = _a.totalDaysInView;\n    var max = dateAdapter.max, differenceInSeconds = dateAdapter.differenceInSeconds, addDays = dateAdapter.addDays, endOfDay = dateAdapter.endOfDay, differenceInDays = dateAdapter.differenceInDays;\n    var span = SECONDS_IN_DAY;\n    var begin = max([event.start, startOfWeekDate]);\n    if (event.end) {\n        switch (precision) {\n            case 'minutes':\n                span = differenceInSeconds(event.end, begin);\n                break;\n            default:\n                span =\n                    differenceInDays(addDays(endOfDay(event.end), 1), begin) *\n                        SECONDS_IN_DAY;\n                break;\n        }\n    }\n    var offsetSeconds = offset * SECONDS_IN_DAY;\n    var totalLength = offsetSeconds + span;\n    // the best way to detect if an event is outside the week-view\n    // is to check if the total span beginning (from startOfWeekDay or event start) exceeds the total days in the view\n    var secondsInView = totalDaysInView * SECONDS_IN_DAY;\n    if (totalLength > secondsInView) {\n        span = secondsInView - offsetSeconds;\n    }\n    span -= getExcludedSeconds(dateAdapter, {\n        startDate: begin,\n        seconds: span,\n        excluded: excluded,\n        precision: precision,\n    });\n    return span / SECONDS_IN_DAY;\n}\nfunction getWeekViewEventOffset(dateAdapter, _a) {\n    var event = _a.event, startOfWeekDate = _a.startOfWeek, excluded = _a.excluded, precision = _a.precision;\n    var differenceInDays = dateAdapter.differenceInDays, startOfDay = dateAdapter.startOfDay, differenceInSeconds = dateAdapter.differenceInSeconds;\n    if (event.start < startOfWeekDate) {\n        return 0;\n    }\n    var offset = 0;\n    switch (precision) {\n        case 'days':\n            offset =\n                differenceInDays(startOfDay(event.start), startOfWeekDate) *\n                    SECONDS_IN_DAY;\n            break;\n        case 'minutes':\n            offset = differenceInSeconds(event.start, startOfWeekDate);\n            break;\n    }\n    offset -= getExcludedSeconds(dateAdapter, {\n        startDate: startOfWeekDate,\n        seconds: offset,\n        excluded: excluded,\n        precision: precision,\n    });\n    return Math.abs(offset / SECONDS_IN_DAY);\n}\nfunction isEventIsPeriod(dateAdapter, _a) {\n    var event = _a.event, periodStart = _a.periodStart, periodEnd = _a.periodEnd;\n    var isSameSecond = dateAdapter.isSameSecond;\n    var eventStart = event.start;\n    var eventEnd = event.end || event.start;\n    if (eventStart > periodStart && eventStart < periodEnd) {\n        return true;\n    }\n    if (eventEnd > periodStart && eventEnd < periodEnd) {\n        return true;\n    }\n    if (eventStart < periodStart && eventEnd > periodEnd) {\n        return true;\n    }\n    if (isSameSecond(eventStart, periodStart) ||\n        isSameSecond(eventStart, periodEnd)) {\n        return true;\n    }\n    if (isSameSecond(eventEnd, periodStart) ||\n        isSameSecond(eventEnd, periodEnd)) {\n        return true;\n    }\n    return false;\n}\nexport function getEventsInPeriod(dateAdapter, _a) {\n    var events = _a.events, periodStart = _a.periodStart, periodEnd = _a.periodEnd;\n    return events.filter(function (event) {\n        return isEventIsPeriod(dateAdapter, { event: event, periodStart: periodStart, periodEnd: periodEnd });\n    });\n}\nfunction getWeekDay(dateAdapter, _a) {\n    var date = _a.date, _b = _a.weekendDays, weekendDays = _b === void 0 ? DEFAULT_WEEKEND_DAYS : _b;\n    var startOfDay = dateAdapter.startOfDay, isSameDay = dateAdapter.isSameDay, getDay = dateAdapter.getDay;\n    var today = startOfDay(new Date());\n    var day = getDay(date);\n    return {\n        date: date,\n        day: day,\n        isPast: date < today,\n        isToday: isSameDay(date, today),\n        isFuture: date > today,\n        isWeekend: weekendDays.indexOf(day) > -1,\n    };\n}\nexport function getWeekViewHeader(dateAdapter, _a) {\n    var viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _b = _a.excluded, excluded = _b === void 0 ? [] : _b, weekendDays = _a.weekendDays, _c = _a.viewStart, viewStart = _c === void 0 ? dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn }) : _c, _d = _a.viewEnd, viewEnd = _d === void 0 ? dateAdapter.addDays(viewStart, DAYS_IN_WEEK) : _d;\n    var addDays = dateAdapter.addDays, getDay = dateAdapter.getDay;\n    var days = [];\n    var date = viewStart;\n    while (date < viewEnd) {\n        if (!excluded.some(function (e) { return getDay(date) === e; })) {\n            days.push(getWeekDay(dateAdapter, { date: date, weekendDays: weekendDays }));\n        }\n        date = addDays(date, 1);\n    }\n    return days;\n}\nexport function getDifferenceInDaysWithExclusions(dateAdapter, _a) {\n    var date1 = _a.date1, date2 = _a.date2, excluded = _a.excluded;\n    var date = date1;\n    var diff = 0;\n    while (date < date2) {\n        if (excluded.indexOf(dateAdapter.getDay(date)) === -1) {\n            diff++;\n        }\n        date = dateAdapter.addDays(date, 1);\n    }\n    return diff;\n}\nexport function getAllDayWeekEvents(dateAdapter, _a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, _c = _a.excluded, excluded = _c === void 0 ? [] : _c, _d = _a.precision, precision = _d === void 0 ? 'days' : _d, _e = _a.absolutePositionedEvents, absolutePositionedEvents = _e === void 0 ? false : _e, viewStart = _a.viewStart, viewEnd = _a.viewEnd;\n    viewStart = dateAdapter.startOfDay(viewStart);\n    viewEnd = dateAdapter.endOfDay(viewEnd);\n    var differenceInSeconds = dateAdapter.differenceInSeconds, differenceInDays = dateAdapter.differenceInDays;\n    var maxRange = getDifferenceInDaysWithExclusions(dateAdapter, {\n        date1: viewStart,\n        date2: viewEnd,\n        excluded: excluded,\n    });\n    var totalDaysInView = differenceInDays(viewEnd, viewStart) + 1;\n    var eventsMapped = events\n        .filter(function (event) { return event.allDay; })\n        .map(function (event) {\n        var offset = getWeekViewEventOffset(dateAdapter, {\n            event: event,\n            startOfWeek: viewStart,\n            excluded: excluded,\n            precision: precision,\n        });\n        var span = getWeekViewEventSpan(dateAdapter, {\n            event: event,\n            offset: offset,\n            startOfWeekDate: viewStart,\n            excluded: excluded,\n            precision: precision,\n            totalDaysInView: totalDaysInView,\n        });\n        return { event: event, offset: offset, span: span };\n    })\n        .filter(function (e) { return e.offset < maxRange; })\n        .filter(function (e) { return e.span > 0; })\n        .map(function (entry) { return ({\n        event: entry.event,\n        offset: entry.offset,\n        span: entry.span,\n        startsBeforeWeek: entry.event.start < viewStart,\n        endsAfterWeek: (entry.event.end || entry.event.start) > viewEnd,\n    }); })\n        .sort(function (itemA, itemB) {\n        var startSecondsDiff = differenceInSeconds(itemA.event.start, itemB.event.start);\n        if (startSecondsDiff === 0) {\n            return differenceInSeconds(itemB.event.end || itemB.event.start, itemA.event.end || itemA.event.start);\n        }\n        return startSecondsDiff;\n    });\n    var allDayEventRows = [];\n    var allocatedEvents = [];\n    eventsMapped.forEach(function (event, index) {\n        if (allocatedEvents.indexOf(event) === -1) {\n            allocatedEvents.push(event);\n            var rowSpan_1 = event.span + event.offset;\n            var otherRowEvents = eventsMapped\n                .slice(index + 1)\n                .filter(function (nextEvent) {\n                if (nextEvent.offset >= rowSpan_1 &&\n                    rowSpan_1 + nextEvent.span <= totalDaysInView &&\n                    allocatedEvents.indexOf(nextEvent) === -1) {\n                    var nextEventOffset = nextEvent.offset - rowSpan_1;\n                    if (!absolutePositionedEvents) {\n                        nextEvent.offset = nextEventOffset;\n                    }\n                    rowSpan_1 += nextEvent.span + nextEventOffset;\n                    allocatedEvents.push(nextEvent);\n                    return true;\n                }\n            });\n            var weekEvents = __spreadArrays([event], otherRowEvents);\n            var id = weekEvents\n                .filter(function (weekEvent) { return weekEvent.event.id; })\n                .map(function (weekEvent) { return weekEvent.event.id; })\n                .join('-');\n            allDayEventRows.push(__assign({ row: weekEvents }, (id ? { id: id } : {})));\n        }\n    });\n    return allDayEventRows;\n}\nfunction getWeekViewHourGrid(dateAdapter, _a) {\n    var events = _a.events, viewDate = _a.viewDate, hourSegments = _a.hourSegments, hourDuration = _a.hourDuration, dayStart = _a.dayStart, dayEnd = _a.dayEnd, weekStartsOn = _a.weekStartsOn, excluded = _a.excluded, weekendDays = _a.weekendDays, segmentHeight = _a.segmentHeight, viewStart = _a.viewStart, viewEnd = _a.viewEnd, minimumEventHeight = _a.minimumEventHeight;\n    var dayViewHourGrid = getDayViewHourGrid(dateAdapter, {\n        viewDate: viewDate,\n        hourSegments: hourSegments,\n        hourDuration: hourDuration,\n        dayStart: dayStart,\n        dayEnd: dayEnd,\n    });\n    var weekDays = getWeekViewHeader(dateAdapter, {\n        viewDate: viewDate,\n        weekStartsOn: weekStartsOn,\n        excluded: excluded,\n        weekendDays: weekendDays,\n        viewStart: viewStart,\n        viewEnd: viewEnd,\n    });\n    var setHours = dateAdapter.setHours, setMinutes = dateAdapter.setMinutes, getHours = dateAdapter.getHours, getMinutes = dateAdapter.getMinutes;\n    return weekDays.map(function (day) {\n        var dayView = getDayView(dateAdapter, {\n            events: events,\n            viewDate: day.date,\n            hourSegments: hourSegments,\n            dayStart: dayStart,\n            dayEnd: dayEnd,\n            segmentHeight: segmentHeight,\n            eventWidth: 1,\n            hourDuration: hourDuration,\n            minimumEventHeight: minimumEventHeight,\n        });\n        var hours = dayViewHourGrid.map(function (hour) {\n            var segments = hour.segments.map(function (segment) {\n                var date = setMinutes(setHours(day.date, getHours(segment.date)), getMinutes(segment.date));\n                return __assign(__assign({}, segment), { date: date });\n            });\n            return __assign(__assign({}, hour), { segments: segments });\n        });\n        function getColumnCount(allEvents, prevOverlappingEvents) {\n            var columnCount = Math.max.apply(Math, prevOverlappingEvents.map(function (iEvent) { return iEvent.left + 1; }));\n            var nextOverlappingEvents = allEvents\n                .filter(function (iEvent) { return iEvent.left >= columnCount; })\n                .filter(function (iEvent) {\n                return (getOverLappingWeekViewEvents(prevOverlappingEvents, iEvent.top, iEvent.top + iEvent.height).length > 0);\n            });\n            if (nextOverlappingEvents.length > 0) {\n                return getColumnCount(allEvents, nextOverlappingEvents);\n            }\n            else {\n                return columnCount;\n            }\n        }\n        var mappedEvents = dayView.events.map(function (event) {\n            var columnCount = getColumnCount(dayView.events, getOverLappingWeekViewEvents(dayView.events, event.top, event.top + event.height));\n            var width = 100 / columnCount;\n            return __assign(__assign({}, event), { left: event.left * width, width: width });\n        });\n        return {\n            hours: hours,\n            date: day.date,\n            events: mappedEvents.map(function (event) {\n                var overLappingEvents = getOverLappingWeekViewEvents(mappedEvents.filter(function (otherEvent) { return otherEvent.left > event.left; }), event.top, event.top + event.height);\n                if (overLappingEvents.length > 0) {\n                    return __assign(__assign({}, event), { width: Math.min.apply(Math, overLappingEvents.map(function (otherEvent) { return otherEvent.left; })) - event.left });\n                }\n                return event;\n            }),\n        };\n    });\n}\nexport function getWeekView(dateAdapter, _a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _c = _a.excluded, excluded = _c === void 0 ? [] : _c, _d = _a.precision, precision = _d === void 0 ? 'days' : _d, _e = _a.absolutePositionedEvents, absolutePositionedEvents = _e === void 0 ? false : _e, hourSegments = _a.hourSegments, hourDuration = _a.hourDuration, dayStart = _a.dayStart, dayEnd = _a.dayEnd, weekendDays = _a.weekendDays, segmentHeight = _a.segmentHeight, minimumEventHeight = _a.minimumEventHeight, _f = _a.viewStart, viewStart = _f === void 0 ? dateAdapter.startOfWeek(viewDate, { weekStartsOn: weekStartsOn }) : _f, _g = _a.viewEnd, viewEnd = _g === void 0 ? dateAdapter.endOfWeek(viewDate, { weekStartsOn: weekStartsOn }) : _g;\n    if (!events) {\n        events = [];\n    }\n    var startOfDay = dateAdapter.startOfDay, endOfDay = dateAdapter.endOfDay;\n    viewStart = startOfDay(viewStart);\n    viewEnd = endOfDay(viewEnd);\n    var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n        events: events,\n        periodStart: viewStart,\n        periodEnd: viewEnd,\n    });\n    var header = getWeekViewHeader(dateAdapter, {\n        viewDate: viewDate,\n        weekStartsOn: weekStartsOn,\n        excluded: excluded,\n        weekendDays: weekendDays,\n        viewStart: viewStart,\n        viewEnd: viewEnd,\n    });\n    return {\n        allDayEventRows: getAllDayWeekEvents(dateAdapter, {\n            events: eventsInPeriod,\n            excluded: excluded,\n            precision: precision,\n            absolutePositionedEvents: absolutePositionedEvents,\n            viewStart: viewStart,\n            viewEnd: viewEnd,\n        }),\n        period: {\n            events: eventsInPeriod,\n            start: header[0].date,\n            end: endOfDay(header[header.length - 1].date),\n        },\n        hourColumns: getWeekViewHourGrid(dateAdapter, {\n            events: events,\n            viewDate: viewDate,\n            hourSegments: hourSegments,\n            hourDuration: hourDuration,\n            dayStart: dayStart,\n            dayEnd: dayEnd,\n            weekStartsOn: weekStartsOn,\n            excluded: excluded,\n            weekendDays: weekendDays,\n            segmentHeight: segmentHeight,\n            viewStart: viewStart,\n            viewEnd: viewEnd,\n            minimumEventHeight: minimumEventHeight,\n        }),\n    };\n}\nexport function getMonthView(dateAdapter, _a) {\n    var _b = _a.events, events = _b === void 0 ? [] : _b, viewDate = _a.viewDate, weekStartsOn = _a.weekStartsOn, _c = _a.excluded, excluded = _c === void 0 ? [] : _c, _d = _a.viewStart, viewStart = _d === void 0 ? dateAdapter.startOfMonth(viewDate) : _d, _e = _a.viewEnd, viewEnd = _e === void 0 ? dateAdapter.endOfMonth(viewDate) : _e, weekendDays = _a.weekendDays;\n    if (!events) {\n        events = [];\n    }\n    var startOfWeek = dateAdapter.startOfWeek, endOfWeek = dateAdapter.endOfWeek, differenceInDays = dateAdapter.differenceInDays, startOfDay = dateAdapter.startOfDay, addHours = dateAdapter.addHours, endOfDay = dateAdapter.endOfDay, isSameMonth = dateAdapter.isSameMonth, getDay = dateAdapter.getDay, getMonth = dateAdapter.getMonth;\n    var start = startOfWeek(viewStart, { weekStartsOn: weekStartsOn });\n    var end = endOfWeek(viewEnd, { weekStartsOn: weekStartsOn });\n    var eventsInMonth = getEventsInPeriod(dateAdapter, {\n        events: events,\n        periodStart: start,\n        periodEnd: end,\n    });\n    var initialViewDays = [];\n    var previousDate;\n    var _loop_2 = function (i) {\n        // hacky fix for https://github.com/mattlewis92/angular-calendar/issues/173\n        var date;\n        if (previousDate) {\n            date = startOfDay(addHours(previousDate, HOURS_IN_DAY));\n            if (previousDate.getTime() === date.getTime()) {\n                // DST change, so need to add 25 hours\n                /* istanbul ignore next */\n                date = startOfDay(addHours(previousDate, HOURS_IN_DAY + 1));\n            }\n            previousDate = date;\n        }\n        else {\n            date = previousDate = start;\n        }\n        if (!excluded.some(function (e) { return getDay(date) === e; })) {\n            var day = getWeekDay(dateAdapter, {\n                date: date,\n                weekendDays: weekendDays,\n            });\n            var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n                events: eventsInMonth,\n                periodStart: startOfDay(date),\n                periodEnd: endOfDay(date),\n            });\n            day.inMonth = isSameMonth(date, viewDate);\n            day.events = eventsInPeriod;\n            day.badgeTotal = eventsInPeriod.length;\n            initialViewDays.push(day);\n        }\n    };\n    for (var i = 0; i < differenceInDays(end, start) + 1; i++) {\n        _loop_2(i);\n    }\n    var days = [];\n    var totalDaysVisibleInWeek = DAYS_IN_WEEK - excluded.length;\n    if (totalDaysVisibleInWeek < DAYS_IN_WEEK) {\n        for (var i = 0; i < initialViewDays.length; i += totalDaysVisibleInWeek) {\n            var row = initialViewDays.slice(i, i + totalDaysVisibleInWeek);\n            var isRowInMonth = row.some(function (day) { return viewStart <= day.date && day.date < viewEnd; });\n            if (isRowInMonth) {\n                days = __spreadArrays(days, row);\n            }\n        }\n    }\n    else {\n        days = initialViewDays;\n    }\n    var rows = Math.floor(days.length / totalDaysVisibleInWeek);\n    var rowOffsets = [];\n    for (var i = 0; i < rows; i++) {\n        rowOffsets.push(i * totalDaysVisibleInWeek);\n    }\n    return {\n        rowOffsets: rowOffsets,\n        totalDaysVisibleInWeek: totalDaysVisibleInWeek,\n        days: days,\n        period: {\n            start: days[0].date,\n            end: endOfDay(days[days.length - 1].date),\n            events: eventsInMonth,\n        },\n    };\n}\nfunction getOverLappingWeekViewEvents(events, top, bottom) {\n    return events.filter(function (previousEvent) {\n        var previousEventTop = previousEvent.top;\n        var previousEventBottom = previousEvent.top + previousEvent.height;\n        if (top < previousEventBottom && previousEventBottom < bottom) {\n            return true;\n        }\n        else if (top < previousEventTop && previousEventTop < bottom) {\n            return true;\n        }\n        else if (previousEventTop <= top && bottom <= previousEventBottom) {\n            return true;\n        }\n        return false;\n    });\n}\nfunction getDayView(dateAdapter, _a) {\n    var events = _a.events, viewDate = _a.viewDate, hourSegments = _a.hourSegments, dayStart = _a.dayStart, dayEnd = _a.dayEnd, eventWidth = _a.eventWidth, segmentHeight = _a.segmentHeight, hourDuration = _a.hourDuration, minimumEventHeight = _a.minimumEventHeight;\n    var setMinutes = dateAdapter.setMinutes, setHours = dateAdapter.setHours, startOfDay = dateAdapter.startOfDay, startOfMinute = dateAdapter.startOfMinute, endOfDay = dateAdapter.endOfDay, differenceInMinutes = dateAdapter.differenceInMinutes;\n    var startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));\n    var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));\n    endOfView.setSeconds(59, 999);\n    var previousDayEvents = [];\n    var eventsInPeriod = getEventsInPeriod(dateAdapter, {\n        events: events.filter(function (event) { return !event.allDay; }),\n        periodStart: startOfView,\n        periodEnd: endOfView,\n    });\n    var dayViewEvents = eventsInPeriod\n        .sort(function (eventA, eventB) {\n        return eventA.start.valueOf() - eventB.start.valueOf();\n    })\n        .map(function (event) {\n        var eventStart = event.start;\n        var eventEnd = event.end || eventStart;\n        var startsBeforeDay = eventStart < startOfView;\n        var endsAfterDay = eventEnd > endOfView;\n        var hourHeightModifier = (hourSegments * segmentHeight) / (hourDuration || MINUTES_IN_HOUR);\n        var top = 0;\n        if (eventStart > startOfView) {\n            // adjust the difference in minutes if the user's offset is different between the start of the day and the event (e.g. when going to or from DST)\n            var eventOffset = eventStart.getTimezoneOffset();\n            var startOffset = startOfView.getTimezoneOffset();\n            var diff = startOffset - eventOffset;\n            top += differenceInMinutes(eventStart, startOfView) + diff;\n        }\n        top *= hourHeightModifier;\n        var startDate = startsBeforeDay ? startOfView : eventStart;\n        var endDate = endsAfterDay ? endOfView : eventEnd;\n        var timezoneOffset = startDate.getTimezoneOffset() - endDate.getTimezoneOffset();\n        var height = differenceInMinutes(endDate, startDate) + timezoneOffset;\n        if (!event.end) {\n            height = segmentHeight;\n        }\n        else {\n            height *= hourHeightModifier;\n        }\n        if (minimumEventHeight && height < minimumEventHeight) {\n            height = minimumEventHeight;\n        }\n        var bottom = top + height;\n        var overlappingPreviousEvents = getOverLappingWeekViewEvents(previousDayEvents, top, bottom);\n        var left = 0;\n        while (overlappingPreviousEvents.some(function (previousEvent) { return previousEvent.left === left; })) {\n            left += eventWidth;\n        }\n        var dayEvent = {\n            event: event,\n            height: height,\n            width: eventWidth,\n            top: top,\n            left: left,\n            startsBeforeDay: startsBeforeDay,\n            endsAfterDay: endsAfterDay,\n        };\n        previousDayEvents.push(dayEvent);\n        return dayEvent;\n    });\n    var width = Math.max.apply(Math, dayViewEvents.map(function (event) { return event.left + event.width; }));\n    var allDayEvents = getEventsInPeriod(dateAdapter, {\n        events: events.filter(function (event) { return event.allDay; }),\n        periodStart: startOfDay(startOfView),\n        periodEnd: endOfDay(endOfView),\n    });\n    return {\n        events: dayViewEvents,\n        width: width,\n        allDayEvents: allDayEvents,\n        period: {\n            events: eventsInPeriod,\n            start: startOfView,\n            end: endOfView,\n        },\n    };\n}\nfunction sanitiseHours(hours) {\n    return Math.max(Math.min(23, hours), 0);\n}\nfunction sanitiseMinutes(minutes) {\n    return Math.max(Math.min(59, minutes), 0);\n}\nfunction getDayViewHourGrid(dateAdapter, _a) {\n    var viewDate = _a.viewDate, hourSegments = _a.hourSegments, hourDuration = _a.hourDuration, dayStart = _a.dayStart, dayEnd = _a.dayEnd;\n    var setMinutes = dateAdapter.setMinutes, setHours = dateAdapter.setHours, startOfDay = dateAdapter.startOfDay, startOfMinute = dateAdapter.startOfMinute, endOfDay = dateAdapter.endOfDay, addMinutes = dateAdapter.addMinutes, addHours = dateAdapter.addHours, addDays = dateAdapter.addDays;\n    var hours = [];\n    var startOfView = setMinutes(setHours(startOfDay(viewDate), sanitiseHours(dayStart.hour)), sanitiseMinutes(dayStart.minute));\n    var endOfView = setMinutes(setHours(startOfMinute(endOfDay(viewDate)), sanitiseHours(dayEnd.hour)), sanitiseMinutes(dayEnd.minute));\n    var segmentDuration = (hourDuration || MINUTES_IN_HOUR) / hourSegments;\n    var startOfViewDay = startOfDay(viewDate);\n    var endOfViewDay = endOfDay(viewDate);\n    var dateAdjustment = function (d) { return d; };\n    // this means that we change from or to DST on this day and that's going to cause problems so we bump the date\n    if (startOfViewDay.getTimezoneOffset() !== endOfViewDay.getTimezoneOffset()) {\n        startOfViewDay = addDays(startOfViewDay, 1);\n        startOfView = addDays(startOfView, 1);\n        endOfView = addDays(endOfView, 1);\n        dateAdjustment = function (d) { return addDays(d, -1); };\n    }\n    var dayDuration = hourDuration\n        ? (HOURS_IN_DAY * 60) / hourDuration\n        : MINUTES_IN_HOUR;\n    for (var i = 0; i < dayDuration; i++) {\n        var segments = [];\n        for (var j = 0; j < hourSegments; j++) {\n            var date = addMinutes(addMinutes(startOfView, i * (hourDuration || MINUTES_IN_HOUR)), j * segmentDuration);\n            if (date >= startOfView && date < endOfView) {\n                segments.push({\n                    date: dateAdjustment(date),\n                    displayDate: date,\n                    isStart: j === 0,\n                });\n            }\n        }\n        if (segments.length > 0) {\n            hours.push({ segments: segments });\n        }\n    }\n    return hours;\n}\nexport var EventValidationErrorMessage;\n(function (EventValidationErrorMessage) {\n    EventValidationErrorMessage[\"NotArray\"] = \"Events must be an array\";\n    EventValidationErrorMessage[\"StartPropertyMissing\"] = \"Event is missing the `start` property\";\n    EventValidationErrorMessage[\"StartPropertyNotDate\"] = \"Event `start` property should be a javascript date object. Do `new Date(event.start)` to fix it.\";\n    EventValidationErrorMessage[\"EndPropertyNotDate\"] = \"Event `end` property should be a javascript date object. Do `new Date(event.end)` to fix it.\";\n    EventValidationErrorMessage[\"EndsBeforeStart\"] = \"Event `start` property occurs after the `end`\";\n})(EventValidationErrorMessage || (EventValidationErrorMessage = {}));\nexport function validateEvents(events, log) {\n    var isValid = true;\n    function isError(msg, event) {\n        log(msg, event);\n        isValid = false;\n    }\n    if (!Array.isArray(events)) {\n        log(EventValidationErrorMessage.NotArray, events);\n        return false;\n    }\n    events.forEach(function (event) {\n        if (!event.start) {\n            isError(EventValidationErrorMessage.StartPropertyMissing, event);\n        }\n        else if (!(event.start instanceof Date)) {\n            isError(EventValidationErrorMessage.StartPropertyNotDate, event);\n        }\n        if (event.end) {\n            if (!(event.end instanceof Date)) {\n                isError(EventValidationErrorMessage.EndPropertyNotDate, event);\n            }\n            if (event.start > event.end) {\n                isError(EventValidationErrorMessage.EndsBeforeStart, event);\n            }\n        }\n    });\n    return isValid;\n}\n//# sourceMappingURL=calendar-utils.js.map"]},"metadata":{},"sourceType":"module"}