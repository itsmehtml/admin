{"ast":null,"code":"var Clip = require(\"./Clip\");\n\nvar color = require(\"../tool/color\");\n\nvar _util = require(\"../core/util\");\n\nvar isArrayLike = _util.isArrayLike;\n/**\r\n * @module echarts/animation/Animator\r\n */\n\nvar arraySlice = Array.prototype.slice;\n\nfunction defaultGetter(target, key) {\n  return target[key];\n}\n\nfunction defaultSetter(target, key, value) {\n  target[key] = value;\n}\n/**\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} percent\r\n * @return {number}\r\n */\n\n\nfunction interpolateNumber(p0, p1, percent) {\n  return (p1 - p0) * percent + p0;\n}\n/**\r\n * @param  {string} p0\r\n * @param  {string} p1\r\n * @param  {number} percent\r\n * @return {string}\r\n */\n\n\nfunction interpolateString(p0, p1, percent) {\n  return percent > 0.5 ? p1 : p0;\n}\n/**\r\n * @param  {Array} p0\r\n * @param  {Array} p1\r\n * @param  {number} percent\r\n * @param  {Array} out\r\n * @param  {number} arrDim\r\n */\n\n\nfunction interpolateArray(p0, p1, percent, out, arrDim) {\n  var len = p0.length;\n\n  if (arrDim === 1) {\n    for (var i = 0; i < len; i++) {\n      out[i] = interpolateNumber(p0[i], p1[i], percent);\n    }\n  } else {\n    var len2 = len && p0[0].length;\n\n    for (var i = 0; i < len; i++) {\n      for (var j = 0; j < len2; j++) {\n        out[i][j] = interpolateNumber(p0[i][j], p1[i][j], percent);\n      }\n    }\n  }\n} // arr0 is source array, arr1 is target array.\n// Do some preprocess to avoid error happened when interpolating from arr0 to arr1\n\n\nfunction fillArr(arr0, arr1, arrDim) {\n  var arr0Len = arr0.length;\n  var arr1Len = arr1.length;\n\n  if (arr0Len !== arr1Len) {\n    // FIXME Not work for TypedArray\n    var isPreviousLarger = arr0Len > arr1Len;\n\n    if (isPreviousLarger) {\n      // Cut the previous\n      arr0.length = arr1Len;\n    } else {\n      // Fill the previous\n      for (var i = arr0Len; i < arr1Len; i++) {\n        arr0.push(arrDim === 1 ? arr1[i] : arraySlice.call(arr1[i]));\n      }\n    }\n  } // Handling NaN value\n\n\n  var len2 = arr0[0] && arr0[0].length;\n\n  for (var i = 0; i < arr0.length; i++) {\n    if (arrDim === 1) {\n      if (isNaN(arr0[i])) {\n        arr0[i] = arr1[i];\n      }\n    } else {\n      for (var j = 0; j < len2; j++) {\n        if (isNaN(arr0[i][j])) {\n          arr0[i][j] = arr1[i][j];\n        }\n      }\n    }\n  }\n}\n/**\r\n * @param  {Array} arr0\r\n * @param  {Array} arr1\r\n * @param  {number} arrDim\r\n * @return {boolean}\r\n */\n\n\nfunction isArraySame(arr0, arr1, arrDim) {\n  if (arr0 === arr1) {\n    return true;\n  }\n\n  var len = arr0.length;\n\n  if (len !== arr1.length) {\n    return false;\n  }\n\n  if (arrDim === 1) {\n    for (var i = 0; i < len; i++) {\n      if (arr0[i] !== arr1[i]) {\n        return false;\n      }\n    }\n  } else {\n    var len2 = arr0[0].length;\n\n    for (var i = 0; i < len; i++) {\n      for (var j = 0; j < len2; j++) {\n        if (arr0[i][j] !== arr1[i][j]) {\n          return false;\n        }\n      }\n    }\n  }\n\n  return true;\n}\n/**\r\n * Catmull Rom interpolate array\r\n * @param  {Array} p0\r\n * @param  {Array} p1\r\n * @param  {Array} p2\r\n * @param  {Array} p3\r\n * @param  {number} t\r\n * @param  {number} t2\r\n * @param  {number} t3\r\n * @param  {Array} out\r\n * @param  {number} arrDim\r\n */\n\n\nfunction catmullRomInterpolateArray(p0, p1, p2, p3, t, t2, t3, out, arrDim) {\n  var len = p0.length;\n\n  if (arrDim === 1) {\n    for (var i = 0; i < len; i++) {\n      out[i] = catmullRomInterpolate(p0[i], p1[i], p2[i], p3[i], t, t2, t3);\n    }\n  } else {\n    var len2 = p0[0].length;\n\n    for (var i = 0; i < len; i++) {\n      for (var j = 0; j < len2; j++) {\n        out[i][j] = catmullRomInterpolate(p0[i][j], p1[i][j], p2[i][j], p3[i][j], t, t2, t3);\n      }\n    }\n  }\n}\n/**\r\n * Catmull Rom interpolate number\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} t\r\n * @param  {number} t2\r\n * @param  {number} t3\r\n * @return {number}\r\n */\n\n\nfunction catmullRomInterpolate(p0, p1, p2, p3, t, t2, t3) {\n  var v0 = (p2 - p0) * 0.5;\n  var v1 = (p3 - p1) * 0.5;\n  return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\n}\n\nfunction cloneValue(value) {\n  if (isArrayLike(value)) {\n    var len = value.length;\n\n    if (isArrayLike(value[0])) {\n      var ret = [];\n\n      for (var i = 0; i < len; i++) {\n        ret.push(arraySlice.call(value[i]));\n      }\n\n      return ret;\n    }\n\n    return arraySlice.call(value);\n  }\n\n  return value;\n}\n\nfunction rgba2String(rgba) {\n  rgba[0] = Math.floor(rgba[0]);\n  rgba[1] = Math.floor(rgba[1]);\n  rgba[2] = Math.floor(rgba[2]);\n  return 'rgba(' + rgba.join(',') + ')';\n}\n\nfunction getArrayDim(keyframes) {\n  var lastValue = keyframes[keyframes.length - 1].value;\n  return isArrayLike(lastValue && lastValue[0]) ? 2 : 1;\n}\n\nfunction createTrackClip(animator, easing, oneTrackDone, keyframes, propName, forceAnimate) {\n  var getter = animator._getter;\n  var setter = animator._setter;\n  var useSpline = easing === 'spline';\n  var trackLen = keyframes.length;\n\n  if (!trackLen) {\n    return;\n  } // Guess data type\n\n\n  var firstVal = keyframes[0].value;\n  var isValueArray = isArrayLike(firstVal);\n  var isValueColor = false;\n  var isValueString = false; // For vertices morphing\n\n  var arrDim = isValueArray ? getArrayDim(keyframes) : 0;\n  var trackMaxTime; // Sort keyframe as ascending\n\n  keyframes.sort(function (a, b) {\n    return a.time - b.time;\n  });\n  trackMaxTime = keyframes[trackLen - 1].time; // Percents of each keyframe\n\n  var kfPercents = []; // Value of each keyframe\n\n  var kfValues = [];\n  var prevValue = keyframes[0].value;\n  var isAllValueEqual = true;\n\n  for (var i = 0; i < trackLen; i++) {\n    kfPercents.push(keyframes[i].time / trackMaxTime); // Assume value is a color when it is a string\n\n    var value = keyframes[i].value; // Check if value is equal, deep check if value is array\n\n    if (!(isValueArray && isArraySame(value, prevValue, arrDim) || !isValueArray && value === prevValue)) {\n      isAllValueEqual = false;\n    }\n\n    prevValue = value; // Try converting a string to a color array\n\n    if (typeof value === 'string') {\n      var colorArray = color.parse(value);\n\n      if (colorArray) {\n        value = colorArray;\n        isValueColor = true;\n      } else {\n        isValueString = true;\n      }\n    }\n\n    kfValues.push(value);\n  }\n\n  if (!forceAnimate && isAllValueEqual) {\n    return;\n  }\n\n  var lastValue = kfValues[trackLen - 1]; // Polyfill array and NaN value\n\n  for (var i = 0; i < trackLen - 1; i++) {\n    if (isValueArray) {\n      fillArr(kfValues[i], lastValue, arrDim);\n    } else {\n      if (isNaN(kfValues[i]) && !isNaN(lastValue) && !isValueString && !isValueColor) {\n        kfValues[i] = lastValue;\n      }\n    }\n  }\n\n  isValueArray && fillArr(getter(animator._target, propName), lastValue, arrDim); // Cache the key of last frame to speed up when\n  // animation playback is sequency\n\n  var lastFrame = 0;\n  var lastFramePercent = 0;\n  var start;\n  var w;\n  var p0;\n  var p1;\n  var p2;\n  var p3;\n\n  if (isValueColor) {\n    var rgba = [0, 0, 0, 0];\n  }\n\n  var onframe = function onframe(target, percent) {\n    // Find the range keyframes\n    // kf1-----kf2---------current--------kf3\n    // find kf2 and kf3 and do interpolation\n    var frame; // In the easing function like elasticOut, percent may less than 0\n\n    if (percent < 0) {\n      frame = 0;\n    } else if (percent < lastFramePercent) {\n      // Start from next key\n      // PENDING start from lastFrame ?\n      start = Math.min(lastFrame + 1, trackLen - 1);\n\n      for (frame = start; frame >= 0; frame--) {\n        if (kfPercents[frame] <= percent) {\n          break;\n        }\n      } // PENDING really need to do this ?\n\n\n      frame = Math.min(frame, trackLen - 2);\n    } else {\n      for (frame = lastFrame; frame < trackLen; frame++) {\n        if (kfPercents[frame] > percent) {\n          break;\n        }\n      }\n\n      frame = Math.min(frame - 1, trackLen - 2);\n    }\n\n    lastFrame = frame;\n    lastFramePercent = percent;\n    var range = kfPercents[frame + 1] - kfPercents[frame];\n\n    if (range === 0) {\n      return;\n    } else {\n      w = (percent - kfPercents[frame]) / range;\n    }\n\n    if (useSpline) {\n      p1 = kfValues[frame];\n      p0 = kfValues[frame === 0 ? frame : frame - 1];\n      p2 = kfValues[frame > trackLen - 2 ? trackLen - 1 : frame + 1];\n      p3 = kfValues[frame > trackLen - 3 ? trackLen - 1 : frame + 2];\n\n      if (isValueArray) {\n        catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, getter(target, propName), arrDim);\n      } else {\n        var value;\n\n        if (isValueColor) {\n          value = catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, rgba, 1);\n          value = rgba2String(rgba);\n        } else if (isValueString) {\n          // String is step(0.5)\n          return interpolateString(p1, p2, w);\n        } else {\n          value = catmullRomInterpolate(p0, p1, p2, p3, w, w * w, w * w * w);\n        }\n\n        setter(target, propName, value);\n      }\n    } else {\n      if (isValueArray) {\n        interpolateArray(kfValues[frame], kfValues[frame + 1], w, getter(target, propName), arrDim);\n      } else {\n        var value;\n\n        if (isValueColor) {\n          interpolateArray(kfValues[frame], kfValues[frame + 1], w, rgba, 1);\n          value = rgba2String(rgba);\n        } else if (isValueString) {\n          // String is step(0.5)\n          return interpolateString(kfValues[frame], kfValues[frame + 1], w);\n        } else {\n          value = interpolateNumber(kfValues[frame], kfValues[frame + 1], w);\n        }\n\n        setter(target, propName, value);\n      }\n    }\n  };\n\n  var clip = new Clip({\n    target: animator._target,\n    life: trackMaxTime,\n    loop: animator._loop,\n    delay: animator._delay,\n    onframe: onframe,\n    ondestroy: oneTrackDone\n  });\n\n  if (easing && easing !== 'spline') {\n    clip.easing = easing;\n  }\n\n  return clip;\n}\n/**\r\n * @alias module:zrender/animation/Animator\r\n * @constructor\r\n * @param {Object} target\r\n * @param {boolean} loop\r\n * @param {Function} getter\r\n * @param {Function} setter\r\n */\n\n\nvar Animator = function Animator(target, loop, getter, setter) {\n  this._tracks = {};\n  this._target = target;\n  this._loop = loop || false;\n  this._getter = getter || defaultGetter;\n  this._setter = setter || defaultSetter;\n  this._clipCount = 0;\n  this._delay = 0;\n  this._doneList = [];\n  this._onframeList = [];\n  this._clipList = [];\n};\n\nAnimator.prototype = {\n  /**\r\n   * 设置动画关键帧\r\n   * @param  {number} time 关键帧时间，单位是ms\r\n   * @param  {Object} props 关键帧的属性值，key-value表示\r\n   * @return {module:zrender/animation/Animator}\r\n   */\n  when: function when(time\n  /* ms */\n  , props) {\n    var tracks = this._tracks;\n\n    for (var propName in props) {\n      if (!props.hasOwnProperty(propName)) {\n        continue;\n      }\n\n      if (!tracks[propName]) {\n        tracks[propName] = []; // Invalid value\n\n        var value = this._getter(this._target, propName);\n\n        if (value == null) {\n          // zrLog('Invalid property ' + propName);\n          continue;\n        } // If time is 0\n        //  Then props is given initialize value\n        // Else\n        //  Initialize value from current prop value\n\n\n        if (time !== 0) {\n          tracks[propName].push({\n            time: 0,\n            value: cloneValue(value)\n          });\n        }\n      }\n\n      tracks[propName].push({\n        time: time,\n        value: props[propName]\n      });\n    }\n\n    return this;\n  },\n\n  /**\r\n   * 添加动画每一帧的回调函数\r\n   * @param  {Function} callback\r\n   * @return {module:zrender/animation/Animator}\r\n   */\n  during: function during(callback) {\n    this._onframeList.push(callback);\n\n    return this;\n  },\n  pause: function pause() {\n    for (var i = 0; i < this._clipList.length; i++) {\n      this._clipList[i].pause();\n    }\n\n    this._paused = true;\n  },\n  resume: function resume() {\n    for (var i = 0; i < this._clipList.length; i++) {\n      this._clipList[i].resume();\n    }\n\n    this._paused = false;\n  },\n  isPaused: function isPaused() {\n    return !!this._paused;\n  },\n  _doneCallback: function _doneCallback() {\n    // Clear all tracks\n    this._tracks = {}; // Clear all clips\n\n    this._clipList.length = 0;\n    var doneList = this._doneList;\n    var len = doneList.length;\n\n    for (var i = 0; i < len; i++) {\n      doneList[i].call(this);\n    }\n  },\n\n  /**\r\n   * 开始执行动画\r\n   * @param  {string|Function} [easing]\r\n   *         动画缓动函数，详见{@link module:zrender/animation/easing}\r\n   * @param  {boolean} forceAnimate\r\n   * @return {module:zrender/animation/Animator}\r\n   */\n  start: function start(easing, forceAnimate) {\n    var self = this;\n    var clipCount = 0;\n\n    var oneTrackDone = function oneTrackDone() {\n      clipCount--;\n\n      if (!clipCount) {\n        self._doneCallback();\n      }\n    };\n\n    var lastClip;\n\n    for (var propName in this._tracks) {\n      if (!this._tracks.hasOwnProperty(propName)) {\n        continue;\n      }\n\n      var clip = createTrackClip(this, easing, oneTrackDone, this._tracks[propName], propName, forceAnimate);\n\n      if (clip) {\n        this._clipList.push(clip);\n\n        clipCount++; // If start after added to animation\n\n        if (this.animation) {\n          this.animation.addClip(clip);\n        }\n\n        lastClip = clip;\n      }\n    } // Add during callback on the last clip\n\n\n    if (lastClip) {\n      var oldOnFrame = lastClip.onframe;\n\n      lastClip.onframe = function (target, percent) {\n        oldOnFrame(target, percent);\n\n        for (var i = 0; i < self._onframeList.length; i++) {\n          self._onframeList[i](target, percent);\n        }\n      };\n    } // This optimization will help the case that in the upper application\n    // the view may be refreshed frequently, where animation will be\n    // called repeatly but nothing changed.\n\n\n    if (!clipCount) {\n      this._doneCallback();\n    }\n\n    return this;\n  },\n\n  /**\r\n   * 停止动画\r\n   * @param {boolean} forwardToLast If move to last frame before stop\r\n   */\n  stop: function stop(forwardToLast) {\n    var clipList = this._clipList;\n    var animation = this.animation;\n\n    for (var i = 0; i < clipList.length; i++) {\n      var clip = clipList[i];\n\n      if (forwardToLast) {\n        // Move to last frame before stop\n        clip.onframe(this._target, 1);\n      }\n\n      animation && animation.removeClip(clip);\n    }\n\n    clipList.length = 0;\n  },\n\n  /**\r\n   * 设置动画延迟开始的时间\r\n   * @param  {number} time 单位ms\r\n   * @return {module:zrender/animation/Animator}\r\n   */\n  delay: function delay(time) {\n    this._delay = time;\n    return this;\n  },\n\n  /**\r\n   * 添加动画结束的回调\r\n   * @param  {Function} cb\r\n   * @return {module:zrender/animation/Animator}\r\n   */\n  done: function done(cb) {\n    if (cb) {\n      this._doneList.push(cb);\n    }\n\n    return this;\n  },\n\n  /**\r\n   * @return {Array.<module:zrender/animation/Clip>}\r\n   */\n  getClips: function getClips() {\n    return this._clipList;\n  }\n};\nvar _default = Animator;\nmodule.exports = _default;","map":{"version":3,"sources":["C:/Users/user/Desktop/Admin/node_modules/zrender/lib/animation/Animator.js"],"names":["Clip","require","color","_util","isArrayLike","arraySlice","Array","prototype","slice","defaultGetter","target","key","defaultSetter","value","interpolateNumber","p0","p1","percent","interpolateString","interpolateArray","out","arrDim","len","length","i","len2","j","fillArr","arr0","arr1","arr0Len","arr1Len","isPreviousLarger","push","call","isNaN","isArraySame","catmullRomInterpolateArray","p2","p3","t","t2","t3","catmullRomInterpolate","v0","v1","cloneValue","ret","rgba2String","rgba","Math","floor","join","getArrayDim","keyframes","lastValue","createTrackClip","animator","easing","oneTrackDone","propName","forceAnimate","getter","_getter","setter","_setter","useSpline","trackLen","firstVal","isValueArray","isValueColor","isValueString","trackMaxTime","sort","a","b","time","kfPercents","kfValues","prevValue","isAllValueEqual","colorArray","parse","_target","lastFrame","lastFramePercent","start","w","onframe","frame","min","range","clip","life","loop","_loop","delay","_delay","ondestroy","Animator","_tracks","_clipCount","_doneList","_onframeList","_clipList","when","props","tracks","hasOwnProperty","during","callback","pause","_paused","resume","isPaused","_doneCallback","doneList","self","clipCount","lastClip","animation","addClip","oldOnFrame","stop","forwardToLast","clipList","removeClip","done","cb","getClips","_default","module","exports"],"mappings":"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","sourcesContent":["var Clip = require(\"./Clip\");\r\n\r\nvar color = require(\"../tool/color\");\r\n\r\nvar _util = require(\"../core/util\");\r\n\r\nvar isArrayLike = _util.isArrayLike;\r\n\r\n/**\r\n * @module echarts/animation/Animator\r\n */\r\nvar arraySlice = Array.prototype.slice;\r\n\r\nfunction defaultGetter(target, key) {\r\n  return target[key];\r\n}\r\n\r\nfunction defaultSetter(target, key, value) {\r\n  target[key] = value;\r\n}\r\n/**\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} percent\r\n * @return {number}\r\n */\r\n\r\n\r\nfunction interpolateNumber(p0, p1, percent) {\r\n  return (p1 - p0) * percent + p0;\r\n}\r\n/**\r\n * @param  {string} p0\r\n * @param  {string} p1\r\n * @param  {number} percent\r\n * @return {string}\r\n */\r\n\r\n\r\nfunction interpolateString(p0, p1, percent) {\r\n  return percent > 0.5 ? p1 : p0;\r\n}\r\n/**\r\n * @param  {Array} p0\r\n * @param  {Array} p1\r\n * @param  {number} percent\r\n * @param  {Array} out\r\n * @param  {number} arrDim\r\n */\r\n\r\n\r\nfunction interpolateArray(p0, p1, percent, out, arrDim) {\r\n  var len = p0.length;\r\n\r\n  if (arrDim === 1) {\r\n    for (var i = 0; i < len; i++) {\r\n      out[i] = interpolateNumber(p0[i], p1[i], percent);\r\n    }\r\n  } else {\r\n    var len2 = len && p0[0].length;\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      for (var j = 0; j < len2; j++) {\r\n        out[i][j] = interpolateNumber(p0[i][j], p1[i][j], percent);\r\n      }\r\n    }\r\n  }\r\n} // arr0 is source array, arr1 is target array.\r\n// Do some preprocess to avoid error happened when interpolating from arr0 to arr1\r\n\r\n\r\nfunction fillArr(arr0, arr1, arrDim) {\r\n  var arr0Len = arr0.length;\r\n  var arr1Len = arr1.length;\r\n\r\n  if (arr0Len !== arr1Len) {\r\n    // FIXME Not work for TypedArray\r\n    var isPreviousLarger = arr0Len > arr1Len;\r\n\r\n    if (isPreviousLarger) {\r\n      // Cut the previous\r\n      arr0.length = arr1Len;\r\n    } else {\r\n      // Fill the previous\r\n      for (var i = arr0Len; i < arr1Len; i++) {\r\n        arr0.push(arrDim === 1 ? arr1[i] : arraySlice.call(arr1[i]));\r\n      }\r\n    }\r\n  } // Handling NaN value\r\n\r\n\r\n  var len2 = arr0[0] && arr0[0].length;\r\n\r\n  for (var i = 0; i < arr0.length; i++) {\r\n    if (arrDim === 1) {\r\n      if (isNaN(arr0[i])) {\r\n        arr0[i] = arr1[i];\r\n      }\r\n    } else {\r\n      for (var j = 0; j < len2; j++) {\r\n        if (isNaN(arr0[i][j])) {\r\n          arr0[i][j] = arr1[i][j];\r\n        }\r\n      }\r\n    }\r\n  }\r\n}\r\n/**\r\n * @param  {Array} arr0\r\n * @param  {Array} arr1\r\n * @param  {number} arrDim\r\n * @return {boolean}\r\n */\r\n\r\n\r\nfunction isArraySame(arr0, arr1, arrDim) {\r\n  if (arr0 === arr1) {\r\n    return true;\r\n  }\r\n\r\n  var len = arr0.length;\r\n\r\n  if (len !== arr1.length) {\r\n    return false;\r\n  }\r\n\r\n  if (arrDim === 1) {\r\n    for (var i = 0; i < len; i++) {\r\n      if (arr0[i] !== arr1[i]) {\r\n        return false;\r\n      }\r\n    }\r\n  } else {\r\n    var len2 = arr0[0].length;\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      for (var j = 0; j < len2; j++) {\r\n        if (arr0[i][j] !== arr1[i][j]) {\r\n          return false;\r\n        }\r\n      }\r\n    }\r\n  }\r\n\r\n  return true;\r\n}\r\n/**\r\n * Catmull Rom interpolate array\r\n * @param  {Array} p0\r\n * @param  {Array} p1\r\n * @param  {Array} p2\r\n * @param  {Array} p3\r\n * @param  {number} t\r\n * @param  {number} t2\r\n * @param  {number} t3\r\n * @param  {Array} out\r\n * @param  {number} arrDim\r\n */\r\n\r\n\r\nfunction catmullRomInterpolateArray(p0, p1, p2, p3, t, t2, t3, out, arrDim) {\r\n  var len = p0.length;\r\n\r\n  if (arrDim === 1) {\r\n    for (var i = 0; i < len; i++) {\r\n      out[i] = catmullRomInterpolate(p0[i], p1[i], p2[i], p3[i], t, t2, t3);\r\n    }\r\n  } else {\r\n    var len2 = p0[0].length;\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      for (var j = 0; j < len2; j++) {\r\n        out[i][j] = catmullRomInterpolate(p0[i][j], p1[i][j], p2[i][j], p3[i][j], t, t2, t3);\r\n      }\r\n    }\r\n  }\r\n}\r\n/**\r\n * Catmull Rom interpolate number\r\n * @param  {number} p0\r\n * @param  {number} p1\r\n * @param  {number} p2\r\n * @param  {number} p3\r\n * @param  {number} t\r\n * @param  {number} t2\r\n * @param  {number} t3\r\n * @return {number}\r\n */\r\n\r\n\r\nfunction catmullRomInterpolate(p0, p1, p2, p3, t, t2, t3) {\r\n  var v0 = (p2 - p0) * 0.5;\r\n  var v1 = (p3 - p1) * 0.5;\r\n  return (2 * (p1 - p2) + v0 + v1) * t3 + (-3 * (p1 - p2) - 2 * v0 - v1) * t2 + v0 * t + p1;\r\n}\r\n\r\nfunction cloneValue(value) {\r\n  if (isArrayLike(value)) {\r\n    var len = value.length;\r\n\r\n    if (isArrayLike(value[0])) {\r\n      var ret = [];\r\n\r\n      for (var i = 0; i < len; i++) {\r\n        ret.push(arraySlice.call(value[i]));\r\n      }\r\n\r\n      return ret;\r\n    }\r\n\r\n    return arraySlice.call(value);\r\n  }\r\n\r\n  return value;\r\n}\r\n\r\nfunction rgba2String(rgba) {\r\n  rgba[0] = Math.floor(rgba[0]);\r\n  rgba[1] = Math.floor(rgba[1]);\r\n  rgba[2] = Math.floor(rgba[2]);\r\n  return 'rgba(' + rgba.join(',') + ')';\r\n}\r\n\r\nfunction getArrayDim(keyframes) {\r\n  var lastValue = keyframes[keyframes.length - 1].value;\r\n  return isArrayLike(lastValue && lastValue[0]) ? 2 : 1;\r\n}\r\n\r\nfunction createTrackClip(animator, easing, oneTrackDone, keyframes, propName, forceAnimate) {\r\n  var getter = animator._getter;\r\n  var setter = animator._setter;\r\n  var useSpline = easing === 'spline';\r\n  var trackLen = keyframes.length;\r\n\r\n  if (!trackLen) {\r\n    return;\r\n  } // Guess data type\r\n\r\n\r\n  var firstVal = keyframes[0].value;\r\n  var isValueArray = isArrayLike(firstVal);\r\n  var isValueColor = false;\r\n  var isValueString = false; // For vertices morphing\r\n\r\n  var arrDim = isValueArray ? getArrayDim(keyframes) : 0;\r\n  var trackMaxTime; // Sort keyframe as ascending\r\n\r\n  keyframes.sort(function (a, b) {\r\n    return a.time - b.time;\r\n  });\r\n  trackMaxTime = keyframes[trackLen - 1].time; // Percents of each keyframe\r\n\r\n  var kfPercents = []; // Value of each keyframe\r\n\r\n  var kfValues = [];\r\n  var prevValue = keyframes[0].value;\r\n  var isAllValueEqual = true;\r\n\r\n  for (var i = 0; i < trackLen; i++) {\r\n    kfPercents.push(keyframes[i].time / trackMaxTime); // Assume value is a color when it is a string\r\n\r\n    var value = keyframes[i].value; // Check if value is equal, deep check if value is array\r\n\r\n    if (!(isValueArray && isArraySame(value, prevValue, arrDim) || !isValueArray && value === prevValue)) {\r\n      isAllValueEqual = false;\r\n    }\r\n\r\n    prevValue = value; // Try converting a string to a color array\r\n\r\n    if (typeof value === 'string') {\r\n      var colorArray = color.parse(value);\r\n\r\n      if (colorArray) {\r\n        value = colorArray;\r\n        isValueColor = true;\r\n      } else {\r\n        isValueString = true;\r\n      }\r\n    }\r\n\r\n    kfValues.push(value);\r\n  }\r\n\r\n  if (!forceAnimate && isAllValueEqual) {\r\n    return;\r\n  }\r\n\r\n  var lastValue = kfValues[trackLen - 1]; // Polyfill array and NaN value\r\n\r\n  for (var i = 0; i < trackLen - 1; i++) {\r\n    if (isValueArray) {\r\n      fillArr(kfValues[i], lastValue, arrDim);\r\n    } else {\r\n      if (isNaN(kfValues[i]) && !isNaN(lastValue) && !isValueString && !isValueColor) {\r\n        kfValues[i] = lastValue;\r\n      }\r\n    }\r\n  }\r\n\r\n  isValueArray && fillArr(getter(animator._target, propName), lastValue, arrDim); // Cache the key of last frame to speed up when\r\n  // animation playback is sequency\r\n\r\n  var lastFrame = 0;\r\n  var lastFramePercent = 0;\r\n  var start;\r\n  var w;\r\n  var p0;\r\n  var p1;\r\n  var p2;\r\n  var p3;\r\n\r\n  if (isValueColor) {\r\n    var rgba = [0, 0, 0, 0];\r\n  }\r\n\r\n  var onframe = function (target, percent) {\r\n    // Find the range keyframes\r\n    // kf1-----kf2---------current--------kf3\r\n    // find kf2 and kf3 and do interpolation\r\n    var frame; // In the easing function like elasticOut, percent may less than 0\r\n\r\n    if (percent < 0) {\r\n      frame = 0;\r\n    } else if (percent < lastFramePercent) {\r\n      // Start from next key\r\n      // PENDING start from lastFrame ?\r\n      start = Math.min(lastFrame + 1, trackLen - 1);\r\n\r\n      for (frame = start; frame >= 0; frame--) {\r\n        if (kfPercents[frame] <= percent) {\r\n          break;\r\n        }\r\n      } // PENDING really need to do this ?\r\n\r\n\r\n      frame = Math.min(frame, trackLen - 2);\r\n    } else {\r\n      for (frame = lastFrame; frame < trackLen; frame++) {\r\n        if (kfPercents[frame] > percent) {\r\n          break;\r\n        }\r\n      }\r\n\r\n      frame = Math.min(frame - 1, trackLen - 2);\r\n    }\r\n\r\n    lastFrame = frame;\r\n    lastFramePercent = percent;\r\n    var range = kfPercents[frame + 1] - kfPercents[frame];\r\n\r\n    if (range === 0) {\r\n      return;\r\n    } else {\r\n      w = (percent - kfPercents[frame]) / range;\r\n    }\r\n\r\n    if (useSpline) {\r\n      p1 = kfValues[frame];\r\n      p0 = kfValues[frame === 0 ? frame : frame - 1];\r\n      p2 = kfValues[frame > trackLen - 2 ? trackLen - 1 : frame + 1];\r\n      p3 = kfValues[frame > trackLen - 3 ? trackLen - 1 : frame + 2];\r\n\r\n      if (isValueArray) {\r\n        catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, getter(target, propName), arrDim);\r\n      } else {\r\n        var value;\r\n\r\n        if (isValueColor) {\r\n          value = catmullRomInterpolateArray(p0, p1, p2, p3, w, w * w, w * w * w, rgba, 1);\r\n          value = rgba2String(rgba);\r\n        } else if (isValueString) {\r\n          // String is step(0.5)\r\n          return interpolateString(p1, p2, w);\r\n        } else {\r\n          value = catmullRomInterpolate(p0, p1, p2, p3, w, w * w, w * w * w);\r\n        }\r\n\r\n        setter(target, propName, value);\r\n      }\r\n    } else {\r\n      if (isValueArray) {\r\n        interpolateArray(kfValues[frame], kfValues[frame + 1], w, getter(target, propName), arrDim);\r\n      } else {\r\n        var value;\r\n\r\n        if (isValueColor) {\r\n          interpolateArray(kfValues[frame], kfValues[frame + 1], w, rgba, 1);\r\n          value = rgba2String(rgba);\r\n        } else if (isValueString) {\r\n          // String is step(0.5)\r\n          return interpolateString(kfValues[frame], kfValues[frame + 1], w);\r\n        } else {\r\n          value = interpolateNumber(kfValues[frame], kfValues[frame + 1], w);\r\n        }\r\n\r\n        setter(target, propName, value);\r\n      }\r\n    }\r\n  };\r\n\r\n  var clip = new Clip({\r\n    target: animator._target,\r\n    life: trackMaxTime,\r\n    loop: animator._loop,\r\n    delay: animator._delay,\r\n    onframe: onframe,\r\n    ondestroy: oneTrackDone\r\n  });\r\n\r\n  if (easing && easing !== 'spline') {\r\n    clip.easing = easing;\r\n  }\r\n\r\n  return clip;\r\n}\r\n/**\r\n * @alias module:zrender/animation/Animator\r\n * @constructor\r\n * @param {Object} target\r\n * @param {boolean} loop\r\n * @param {Function} getter\r\n * @param {Function} setter\r\n */\r\n\r\n\r\nvar Animator = function (target, loop, getter, setter) {\r\n  this._tracks = {};\r\n  this._target = target;\r\n  this._loop = loop || false;\r\n  this._getter = getter || defaultGetter;\r\n  this._setter = setter || defaultSetter;\r\n  this._clipCount = 0;\r\n  this._delay = 0;\r\n  this._doneList = [];\r\n  this._onframeList = [];\r\n  this._clipList = [];\r\n};\r\n\r\nAnimator.prototype = {\r\n  /**\r\n   * 设置动画关键帧\r\n   * @param  {number} time 关键帧时间，单位是ms\r\n   * @param  {Object} props 关键帧的属性值，key-value表示\r\n   * @return {module:zrender/animation/Animator}\r\n   */\r\n  when: function (time\r\n  /* ms */\r\n  , props) {\r\n    var tracks = this._tracks;\r\n\r\n    for (var propName in props) {\r\n      if (!props.hasOwnProperty(propName)) {\r\n        continue;\r\n      }\r\n\r\n      if (!tracks[propName]) {\r\n        tracks[propName] = []; // Invalid value\r\n\r\n        var value = this._getter(this._target, propName);\r\n\r\n        if (value == null) {\r\n          // zrLog('Invalid property ' + propName);\r\n          continue;\r\n        } // If time is 0\r\n        //  Then props is given initialize value\r\n        // Else\r\n        //  Initialize value from current prop value\r\n\r\n\r\n        if (time !== 0) {\r\n          tracks[propName].push({\r\n            time: 0,\r\n            value: cloneValue(value)\r\n          });\r\n        }\r\n      }\r\n\r\n      tracks[propName].push({\r\n        time: time,\r\n        value: props[propName]\r\n      });\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * 添加动画每一帧的回调函数\r\n   * @param  {Function} callback\r\n   * @return {module:zrender/animation/Animator}\r\n   */\r\n  during: function (callback) {\r\n    this._onframeList.push(callback);\r\n\r\n    return this;\r\n  },\r\n  pause: function () {\r\n    for (var i = 0; i < this._clipList.length; i++) {\r\n      this._clipList[i].pause();\r\n    }\r\n\r\n    this._paused = true;\r\n  },\r\n  resume: function () {\r\n    for (var i = 0; i < this._clipList.length; i++) {\r\n      this._clipList[i].resume();\r\n    }\r\n\r\n    this._paused = false;\r\n  },\r\n  isPaused: function () {\r\n    return !!this._paused;\r\n  },\r\n  _doneCallback: function () {\r\n    // Clear all tracks\r\n    this._tracks = {}; // Clear all clips\r\n\r\n    this._clipList.length = 0;\r\n    var doneList = this._doneList;\r\n    var len = doneList.length;\r\n\r\n    for (var i = 0; i < len; i++) {\r\n      doneList[i].call(this);\r\n    }\r\n  },\r\n\r\n  /**\r\n   * 开始执行动画\r\n   * @param  {string|Function} [easing]\r\n   *         动画缓动函数，详见{@link module:zrender/animation/easing}\r\n   * @param  {boolean} forceAnimate\r\n   * @return {module:zrender/animation/Animator}\r\n   */\r\n  start: function (easing, forceAnimate) {\r\n    var self = this;\r\n    var clipCount = 0;\r\n\r\n    var oneTrackDone = function () {\r\n      clipCount--;\r\n\r\n      if (!clipCount) {\r\n        self._doneCallback();\r\n      }\r\n    };\r\n\r\n    var lastClip;\r\n\r\n    for (var propName in this._tracks) {\r\n      if (!this._tracks.hasOwnProperty(propName)) {\r\n        continue;\r\n      }\r\n\r\n      var clip = createTrackClip(this, easing, oneTrackDone, this._tracks[propName], propName, forceAnimate);\r\n\r\n      if (clip) {\r\n        this._clipList.push(clip);\r\n\r\n        clipCount++; // If start after added to animation\r\n\r\n        if (this.animation) {\r\n          this.animation.addClip(clip);\r\n        }\r\n\r\n        lastClip = clip;\r\n      }\r\n    } // Add during callback on the last clip\r\n\r\n\r\n    if (lastClip) {\r\n      var oldOnFrame = lastClip.onframe;\r\n\r\n      lastClip.onframe = function (target, percent) {\r\n        oldOnFrame(target, percent);\r\n\r\n        for (var i = 0; i < self._onframeList.length; i++) {\r\n          self._onframeList[i](target, percent);\r\n        }\r\n      };\r\n    } // This optimization will help the case that in the upper application\r\n    // the view may be refreshed frequently, where animation will be\r\n    // called repeatly but nothing changed.\r\n\r\n\r\n    if (!clipCount) {\r\n      this._doneCallback();\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * 停止动画\r\n   * @param {boolean} forwardToLast If move to last frame before stop\r\n   */\r\n  stop: function (forwardToLast) {\r\n    var clipList = this._clipList;\r\n    var animation = this.animation;\r\n\r\n    for (var i = 0; i < clipList.length; i++) {\r\n      var clip = clipList[i];\r\n\r\n      if (forwardToLast) {\r\n        // Move to last frame before stop\r\n        clip.onframe(this._target, 1);\r\n      }\r\n\r\n      animation && animation.removeClip(clip);\r\n    }\r\n\r\n    clipList.length = 0;\r\n  },\r\n\r\n  /**\r\n   * 设置动画延迟开始的时间\r\n   * @param  {number} time 单位ms\r\n   * @return {module:zrender/animation/Animator}\r\n   */\r\n  delay: function (time) {\r\n    this._delay = time;\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * 添加动画结束的回调\r\n   * @param  {Function} cb\r\n   * @return {module:zrender/animation/Animator}\r\n   */\r\n  done: function (cb) {\r\n    if (cb) {\r\n      this._doneList.push(cb);\r\n    }\r\n\r\n    return this;\r\n  },\r\n\r\n  /**\r\n   * @return {Array.<module:zrender/animation/Clip>}\r\n   */\r\n  getClips: function () {\r\n    return this._clipList;\r\n  }\r\n};\r\nvar _default = Animator;\r\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}