{"ast":null,"code":"/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\nvar zrUtil = require(\"zrender/lib/core/util\");\n\nvar graphic = require(\"../../util/graphic\");\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\n\n\nvar NodeHighlightPolicy = {\n  NONE: 'none',\n  // not downplay others\n  DESCENDANT: 'descendant',\n  ANCESTOR: 'ancestor',\n  SELF: 'self'\n};\nvar DEFAULT_SECTOR_Z = 2;\nvar DEFAULT_TEXT_Z = 4;\n/**\r\n * Sunburstce of Sunburst including Sector, Label, LabelLine\r\n * @constructor\r\n * @extends {module:zrender/graphic/Group}\r\n */\n\nfunction SunburstPiece(node, seriesModel, ecModel) {\n  graphic.Group.call(this);\n  var sector = new graphic.Sector({\n    z2: DEFAULT_SECTOR_Z\n  });\n  sector.seriesIndex = seriesModel.seriesIndex;\n  var text = new graphic.Text({\n    z2: DEFAULT_TEXT_Z,\n    silent: node.getModel('label').get('silent')\n  });\n  this.add(sector);\n  this.add(text);\n  this.updateData(true, node, 'normal', seriesModel, ecModel); // Hover to change label and labelLine\n\n  function onEmphasis() {\n    text.ignore = text.hoverIgnore;\n  }\n\n  function onNormal() {\n    text.ignore = text.normalIgnore;\n  }\n\n  this.on('emphasis', onEmphasis).on('normal', onNormal).on('mouseover', onEmphasis).on('mouseout', onNormal);\n}\n\nvar SunburstPieceProto = SunburstPiece.prototype;\n\nSunburstPieceProto.updateData = function (firstCreate, node, state, seriesModel, ecModel) {\n  this.node = node;\n  node.piece = this;\n  seriesModel = seriesModel || this._seriesModel;\n  ecModel = ecModel || this._ecModel;\n  var sector = this.childAt(0);\n  sector.dataIndex = node.dataIndex;\n  var itemModel = node.getModel();\n  var layout = node.getLayout(); // if (!layout) {\n  //     console.log(node.getLayout());\n  // }\n\n  var sectorShape = zrUtil.extend({}, layout);\n  sectorShape.label = null;\n  var visualColor = getNodeColor(node, seriesModel, ecModel);\n  fillDefaultColor(node, seriesModel, visualColor);\n  var normalStyle = itemModel.getModel('itemStyle').getItemStyle();\n  var style;\n\n  if (state === 'normal') {\n    style = normalStyle;\n  } else {\n    var stateStyle = itemModel.getModel(state + '.itemStyle').getItemStyle();\n    style = zrUtil.merge(stateStyle, normalStyle);\n  }\n\n  style = zrUtil.defaults({\n    lineJoin: 'bevel',\n    fill: style.fill || visualColor\n  }, style);\n\n  if (firstCreate) {\n    sector.setShape(sectorShape);\n    sector.shape.r = layout.r0;\n    graphic.updateProps(sector, {\n      shape: {\n        r: layout.r\n      }\n    }, seriesModel, node.dataIndex);\n    sector.useStyle(style);\n  } else if (typeof style.fill === 'object' && style.fill.type || typeof sector.style.fill === 'object' && sector.style.fill.type) {\n    // Disable animation for gradient since no interpolation method\n    // is supported for gradient\n    graphic.updateProps(sector, {\n      shape: sectorShape\n    }, seriesModel);\n    sector.useStyle(style);\n  } else {\n    graphic.updateProps(sector, {\n      shape: sectorShape,\n      style: style\n    }, seriesModel);\n  }\n\n  this._updateLabel(seriesModel, visualColor, state);\n\n  var cursorStyle = itemModel.getShallow('cursor');\n  cursorStyle && sector.attr('cursor', cursorStyle);\n\n  if (firstCreate) {\n    var highlightPolicy = seriesModel.getShallow('highlightPolicy');\n\n    this._initEvents(sector, node, seriesModel, highlightPolicy);\n  }\n\n  this._seriesModel = seriesModel || this._seriesModel;\n  this._ecModel = ecModel || this._ecModel;\n};\n\nSunburstPieceProto.onEmphasis = function (highlightPolicy) {\n  var that = this;\n  this.node.hostTree.root.eachNode(function (n) {\n    if (n.piece) {\n      if (that.node === n) {\n        n.piece.updateData(false, n, 'emphasis');\n      } else if (isNodeHighlighted(n, that.node, highlightPolicy)) {\n        n.piece.childAt(0).trigger('highlight');\n      } else if (highlightPolicy !== NodeHighlightPolicy.NONE) {\n        n.piece.childAt(0).trigger('downplay');\n      }\n    }\n  });\n};\n\nSunburstPieceProto.onNormal = function () {\n  this.node.hostTree.root.eachNode(function (n) {\n    if (n.piece) {\n      n.piece.updateData(false, n, 'normal');\n    }\n  });\n};\n\nSunburstPieceProto.onHighlight = function () {\n  this.updateData(false, this.node, 'highlight');\n};\n\nSunburstPieceProto.onDownplay = function () {\n  this.updateData(false, this.node, 'downplay');\n};\n\nSunburstPieceProto._updateLabel = function (seriesModel, visualColor, state) {\n  var itemModel = this.node.getModel();\n  var normalModel = itemModel.getModel('label');\n  var labelModel = state === 'normal' || state === 'emphasis' ? normalModel : itemModel.getModel(state + '.label');\n  var labelHoverModel = itemModel.getModel('emphasis.label');\n  var text = zrUtil.retrieve(seriesModel.getFormattedLabel(this.node.dataIndex, state, null, null, 'label'), this.node.name);\n\n  if (getLabelAttr('show') === false) {\n    text = '';\n  }\n\n  var layout = this.node.getLayout();\n  var labelMinAngle = labelModel.get('minAngle');\n\n  if (labelMinAngle == null) {\n    labelMinAngle = normalModel.get('minAngle');\n  }\n\n  labelMinAngle = labelMinAngle / 180 * Math.PI;\n  var angle = layout.endAngle - layout.startAngle;\n\n  if (labelMinAngle != null && Math.abs(angle) < labelMinAngle) {\n    // Not displaying text when angle is too small\n    text = '';\n  }\n\n  var label = this.childAt(1);\n  graphic.setLabelStyle(label.style, label.hoverStyle || {}, normalModel, labelHoverModel, {\n    defaultText: labelModel.getShallow('show') ? text : null,\n    autoColor: visualColor,\n    useInsideStyle: true\n  });\n  var midAngle = (layout.startAngle + layout.endAngle) / 2;\n  var dx = Math.cos(midAngle);\n  var dy = Math.sin(midAngle);\n  var r;\n  var labelPosition = getLabelAttr('position');\n  var labelPadding = getLabelAttr('distance') || 0;\n  var textAlign = getLabelAttr('align');\n\n  if (labelPosition === 'outside') {\n    r = layout.r + labelPadding;\n    textAlign = midAngle > Math.PI / 2 ? 'right' : 'left';\n  } else {\n    if (!textAlign || textAlign === 'center') {\n      r = (layout.r + layout.r0) / 2;\n      textAlign = 'center';\n    } else if (textAlign === 'left') {\n      r = layout.r0 + labelPadding;\n\n      if (midAngle > Math.PI / 2) {\n        textAlign = 'right';\n      }\n    } else if (textAlign === 'right') {\n      r = layout.r - labelPadding;\n\n      if (midAngle > Math.PI / 2) {\n        textAlign = 'left';\n      }\n    }\n  }\n\n  label.attr('style', {\n    text: text,\n    textAlign: textAlign,\n    textVerticalAlign: getLabelAttr('verticalAlign') || 'middle',\n    opacity: getLabelAttr('opacity')\n  });\n  var textX = r * dx + layout.cx;\n  var textY = r * dy + layout.cy;\n  label.attr('position', [textX, textY]);\n  var rotateType = getLabelAttr('rotate');\n  var rotate = 0;\n\n  if (rotateType === 'radial') {\n    rotate = -midAngle;\n\n    if (rotate < -Math.PI / 2) {\n      rotate += Math.PI;\n    }\n  } else if (rotateType === 'tangential') {\n    rotate = Math.PI / 2 - midAngle;\n\n    if (rotate > Math.PI / 2) {\n      rotate -= Math.PI;\n    } else if (rotate < -Math.PI / 2) {\n      rotate += Math.PI;\n    }\n  } else if (typeof rotateType === 'number') {\n    rotate = rotateType * Math.PI / 180;\n  }\n\n  label.attr('rotation', rotate);\n\n  function getLabelAttr(name) {\n    var stateAttr = labelModel.get(name);\n\n    if (stateAttr == null) {\n      return normalModel.get(name);\n    } else {\n      return stateAttr;\n    }\n  }\n};\n\nSunburstPieceProto._initEvents = function (sector, node, seriesModel, highlightPolicy) {\n  sector.off('mouseover').off('mouseout').off('emphasis').off('normal');\n  var that = this;\n\n  var onEmphasis = function onEmphasis() {\n    that.onEmphasis(highlightPolicy);\n  };\n\n  var onNormal = function onNormal() {\n    that.onNormal();\n  };\n\n  var onDownplay = function onDownplay() {\n    that.onDownplay();\n  };\n\n  var onHighlight = function onHighlight() {\n    that.onHighlight();\n  };\n\n  if (seriesModel.isAnimationEnabled()) {\n    sector.on('mouseover', onEmphasis).on('mouseout', onNormal).on('emphasis', onEmphasis).on('normal', onNormal).on('downplay', onDownplay).on('highlight', onHighlight);\n  }\n};\n\nzrUtil.inherits(SunburstPiece, graphic.Group);\nvar _default = SunburstPiece;\n/**\r\n * Get node color\r\n *\r\n * @param {TreeNode} node the node to get color\r\n * @param {module:echarts/model/Series} seriesModel series\r\n * @param {module:echarts/model/Global} ecModel echarts defaults\r\n */\n\nfunction getNodeColor(node, seriesModel, ecModel) {\n  // Color from visualMap\n  var visualColor = node.getVisual('color');\n  var visualMetaList = node.getVisual('visualMeta');\n\n  if (!visualMetaList || visualMetaList.length === 0) {\n    // Use first-generation color if has no visualMap\n    visualColor = null;\n  } // Self color or level color\n\n\n  var color = node.getModel('itemStyle').get('color');\n\n  if (color) {\n    return color;\n  } else if (visualColor) {\n    // Color mapping\n    return visualColor;\n  } else if (node.depth === 0) {\n    // Virtual root node\n    return ecModel.option.color[0];\n  } else {\n    // First-generation color\n    var length = ecModel.option.color.length;\n    color = ecModel.option.color[getRootId(node) % length];\n  }\n\n  return color;\n}\n/**\r\n * Get index of root in sorted order\r\n *\r\n * @param {TreeNode} node current node\r\n * @return {number} index in root\r\n */\n\n\nfunction getRootId(node) {\n  var ancestor = node;\n\n  while (ancestor.depth > 1) {\n    ancestor = ancestor.parentNode;\n  }\n\n  var virtualRoot = node.getAncestors()[0];\n  return zrUtil.indexOf(virtualRoot.children, ancestor);\n}\n\nfunction isNodeHighlighted(node, activeNode, policy) {\n  if (policy === NodeHighlightPolicy.NONE) {\n    return false;\n  } else if (policy === NodeHighlightPolicy.SELF) {\n    return node === activeNode;\n  } else if (policy === NodeHighlightPolicy.ANCESTOR) {\n    return node === activeNode || node.isAncestorOf(activeNode);\n  } else {\n    return node === activeNode || node.isDescendantOf(activeNode);\n  }\n} // Fix tooltip callback function params.color incorrect when pick a default color\n\n\nfunction fillDefaultColor(node, seriesModel, color) {\n  var data = seriesModel.getData();\n  data.setItemVisual(node.dataIndex, 'color', color);\n}\n\nmodule.exports = _default;","map":{"version":3,"sources":["C:/Users/user/Desktop/Admin/node_modules/echarts/lib/chart/sunburst/SunburstPiece.js"],"names":["zrUtil","require","graphic","NodeHighlightPolicy","NONE","DESCENDANT","ANCESTOR","SELF","DEFAULT_SECTOR_Z","DEFAULT_TEXT_Z","SunburstPiece","node","seriesModel","ecModel","Group","call","sector","Sector","z2","seriesIndex","text","Text","silent","getModel","get","add","updateData","onEmphasis","ignore","hoverIgnore","onNormal","normalIgnore","on","SunburstPieceProto","prototype","firstCreate","state","piece","_seriesModel","_ecModel","childAt","dataIndex","itemModel","layout","getLayout","sectorShape","extend","label","visualColor","getNodeColor","fillDefaultColor","normalStyle","getItemStyle","style","stateStyle","merge","defaults","lineJoin","fill","setShape","shape","r","r0","updateProps","useStyle","type","_updateLabel","cursorStyle","getShallow","attr","highlightPolicy","_initEvents","that","hostTree","root","eachNode","n","isNodeHighlighted","trigger","onHighlight","onDownplay","normalModel","labelModel","labelHoverModel","retrieve","getFormattedLabel","name","getLabelAttr","labelMinAngle","Math","PI","angle","endAngle","startAngle","abs","setLabelStyle","hoverStyle","defaultText","autoColor","useInsideStyle","midAngle","dx","cos","dy","sin","labelPosition","labelPadding","textAlign","textVerticalAlign","opacity","textX","cx","textY","cy","rotateType","rotate","stateAttr","off","isAnimationEnabled","inherits","_default","getVisual","visualMetaList","length","color","depth","option","getRootId","ancestor","parentNode","virtualRoot","getAncestors","indexOf","children","activeNode","policy","isAncestorOf","isDescendantOf","data","getData","setItemVisual","module","exports"],"mappings":"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","sourcesContent":["\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\n\r\nvar zrUtil = require(\"zrender/lib/core/util\");\r\n\r\nvar graphic = require(\"../../util/graphic\");\r\n\r\n/*\r\n* Licensed to the Apache Software Foundation (ASF) under one\r\n* or more contributor license agreements.  See the NOTICE file\r\n* distributed with this work for additional information\r\n* regarding copyright ownership.  The ASF licenses this file\r\n* to you under the Apache License, Version 2.0 (the\r\n* \"License\"); you may not use this file except in compliance\r\n* with the License.  You may obtain a copy of the License at\r\n*\r\n*   http://www.apache.org/licenses/LICENSE-2.0\r\n*\r\n* Unless required by applicable law or agreed to in writing,\r\n* software distributed under the License is distributed on an\r\n* \"AS IS\" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY\r\n* KIND, either express or implied.  See the License for the\r\n* specific language governing permissions and limitations\r\n* under the License.\r\n*/\r\nvar NodeHighlightPolicy = {\r\n  NONE: 'none',\r\n  // not downplay others\r\n  DESCENDANT: 'descendant',\r\n  ANCESTOR: 'ancestor',\r\n  SELF: 'self'\r\n};\r\nvar DEFAULT_SECTOR_Z = 2;\r\nvar DEFAULT_TEXT_Z = 4;\r\n/**\r\n * Sunburstce of Sunburst including Sector, Label, LabelLine\r\n * @constructor\r\n * @extends {module:zrender/graphic/Group}\r\n */\r\n\r\nfunction SunburstPiece(node, seriesModel, ecModel) {\r\n  graphic.Group.call(this);\r\n  var sector = new graphic.Sector({\r\n    z2: DEFAULT_SECTOR_Z\r\n  });\r\n  sector.seriesIndex = seriesModel.seriesIndex;\r\n  var text = new graphic.Text({\r\n    z2: DEFAULT_TEXT_Z,\r\n    silent: node.getModel('label').get('silent')\r\n  });\r\n  this.add(sector);\r\n  this.add(text);\r\n  this.updateData(true, node, 'normal', seriesModel, ecModel); // Hover to change label and labelLine\r\n\r\n  function onEmphasis() {\r\n    text.ignore = text.hoverIgnore;\r\n  }\r\n\r\n  function onNormal() {\r\n    text.ignore = text.normalIgnore;\r\n  }\r\n\r\n  this.on('emphasis', onEmphasis).on('normal', onNormal).on('mouseover', onEmphasis).on('mouseout', onNormal);\r\n}\r\n\r\nvar SunburstPieceProto = SunburstPiece.prototype;\r\n\r\nSunburstPieceProto.updateData = function (firstCreate, node, state, seriesModel, ecModel) {\r\n  this.node = node;\r\n  node.piece = this;\r\n  seriesModel = seriesModel || this._seriesModel;\r\n  ecModel = ecModel || this._ecModel;\r\n  var sector = this.childAt(0);\r\n  sector.dataIndex = node.dataIndex;\r\n  var itemModel = node.getModel();\r\n  var layout = node.getLayout(); // if (!layout) {\r\n  //     console.log(node.getLayout());\r\n  // }\r\n\r\n  var sectorShape = zrUtil.extend({}, layout);\r\n  sectorShape.label = null;\r\n  var visualColor = getNodeColor(node, seriesModel, ecModel);\r\n  fillDefaultColor(node, seriesModel, visualColor);\r\n  var normalStyle = itemModel.getModel('itemStyle').getItemStyle();\r\n  var style;\r\n\r\n  if (state === 'normal') {\r\n    style = normalStyle;\r\n  } else {\r\n    var stateStyle = itemModel.getModel(state + '.itemStyle').getItemStyle();\r\n    style = zrUtil.merge(stateStyle, normalStyle);\r\n  }\r\n\r\n  style = zrUtil.defaults({\r\n    lineJoin: 'bevel',\r\n    fill: style.fill || visualColor\r\n  }, style);\r\n\r\n  if (firstCreate) {\r\n    sector.setShape(sectorShape);\r\n    sector.shape.r = layout.r0;\r\n    graphic.updateProps(sector, {\r\n      shape: {\r\n        r: layout.r\r\n      }\r\n    }, seriesModel, node.dataIndex);\r\n    sector.useStyle(style);\r\n  } else if (typeof style.fill === 'object' && style.fill.type || typeof sector.style.fill === 'object' && sector.style.fill.type) {\r\n    // Disable animation for gradient since no interpolation method\r\n    // is supported for gradient\r\n    graphic.updateProps(sector, {\r\n      shape: sectorShape\r\n    }, seriesModel);\r\n    sector.useStyle(style);\r\n  } else {\r\n    graphic.updateProps(sector, {\r\n      shape: sectorShape,\r\n      style: style\r\n    }, seriesModel);\r\n  }\r\n\r\n  this._updateLabel(seriesModel, visualColor, state);\r\n\r\n  var cursorStyle = itemModel.getShallow('cursor');\r\n  cursorStyle && sector.attr('cursor', cursorStyle);\r\n\r\n  if (firstCreate) {\r\n    var highlightPolicy = seriesModel.getShallow('highlightPolicy');\r\n\r\n    this._initEvents(sector, node, seriesModel, highlightPolicy);\r\n  }\r\n\r\n  this._seriesModel = seriesModel || this._seriesModel;\r\n  this._ecModel = ecModel || this._ecModel;\r\n};\r\n\r\nSunburstPieceProto.onEmphasis = function (highlightPolicy) {\r\n  var that = this;\r\n  this.node.hostTree.root.eachNode(function (n) {\r\n    if (n.piece) {\r\n      if (that.node === n) {\r\n        n.piece.updateData(false, n, 'emphasis');\r\n      } else if (isNodeHighlighted(n, that.node, highlightPolicy)) {\r\n        n.piece.childAt(0).trigger('highlight');\r\n      } else if (highlightPolicy !== NodeHighlightPolicy.NONE) {\r\n        n.piece.childAt(0).trigger('downplay');\r\n      }\r\n    }\r\n  });\r\n};\r\n\r\nSunburstPieceProto.onNormal = function () {\r\n  this.node.hostTree.root.eachNode(function (n) {\r\n    if (n.piece) {\r\n      n.piece.updateData(false, n, 'normal');\r\n    }\r\n  });\r\n};\r\n\r\nSunburstPieceProto.onHighlight = function () {\r\n  this.updateData(false, this.node, 'highlight');\r\n};\r\n\r\nSunburstPieceProto.onDownplay = function () {\r\n  this.updateData(false, this.node, 'downplay');\r\n};\r\n\r\nSunburstPieceProto._updateLabel = function (seriesModel, visualColor, state) {\r\n  var itemModel = this.node.getModel();\r\n  var normalModel = itemModel.getModel('label');\r\n  var labelModel = state === 'normal' || state === 'emphasis' ? normalModel : itemModel.getModel(state + '.label');\r\n  var labelHoverModel = itemModel.getModel('emphasis.label');\r\n  var text = zrUtil.retrieve(seriesModel.getFormattedLabel(this.node.dataIndex, state, null, null, 'label'), this.node.name);\r\n\r\n  if (getLabelAttr('show') === false) {\r\n    text = '';\r\n  }\r\n\r\n  var layout = this.node.getLayout();\r\n  var labelMinAngle = labelModel.get('minAngle');\r\n\r\n  if (labelMinAngle == null) {\r\n    labelMinAngle = normalModel.get('minAngle');\r\n  }\r\n\r\n  labelMinAngle = labelMinAngle / 180 * Math.PI;\r\n  var angle = layout.endAngle - layout.startAngle;\r\n\r\n  if (labelMinAngle != null && Math.abs(angle) < labelMinAngle) {\r\n    // Not displaying text when angle is too small\r\n    text = '';\r\n  }\r\n\r\n  var label = this.childAt(1);\r\n  graphic.setLabelStyle(label.style, label.hoverStyle || {}, normalModel, labelHoverModel, {\r\n    defaultText: labelModel.getShallow('show') ? text : null,\r\n    autoColor: visualColor,\r\n    useInsideStyle: true\r\n  });\r\n  var midAngle = (layout.startAngle + layout.endAngle) / 2;\r\n  var dx = Math.cos(midAngle);\r\n  var dy = Math.sin(midAngle);\r\n  var r;\r\n  var labelPosition = getLabelAttr('position');\r\n  var labelPadding = getLabelAttr('distance') || 0;\r\n  var textAlign = getLabelAttr('align');\r\n\r\n  if (labelPosition === 'outside') {\r\n    r = layout.r + labelPadding;\r\n    textAlign = midAngle > Math.PI / 2 ? 'right' : 'left';\r\n  } else {\r\n    if (!textAlign || textAlign === 'center') {\r\n      r = (layout.r + layout.r0) / 2;\r\n      textAlign = 'center';\r\n    } else if (textAlign === 'left') {\r\n      r = layout.r0 + labelPadding;\r\n\r\n      if (midAngle > Math.PI / 2) {\r\n        textAlign = 'right';\r\n      }\r\n    } else if (textAlign === 'right') {\r\n      r = layout.r - labelPadding;\r\n\r\n      if (midAngle > Math.PI / 2) {\r\n        textAlign = 'left';\r\n      }\r\n    }\r\n  }\r\n\r\n  label.attr('style', {\r\n    text: text,\r\n    textAlign: textAlign,\r\n    textVerticalAlign: getLabelAttr('verticalAlign') || 'middle',\r\n    opacity: getLabelAttr('opacity')\r\n  });\r\n  var textX = r * dx + layout.cx;\r\n  var textY = r * dy + layout.cy;\r\n  label.attr('position', [textX, textY]);\r\n  var rotateType = getLabelAttr('rotate');\r\n  var rotate = 0;\r\n\r\n  if (rotateType === 'radial') {\r\n    rotate = -midAngle;\r\n\r\n    if (rotate < -Math.PI / 2) {\r\n      rotate += Math.PI;\r\n    }\r\n  } else if (rotateType === 'tangential') {\r\n    rotate = Math.PI / 2 - midAngle;\r\n\r\n    if (rotate > Math.PI / 2) {\r\n      rotate -= Math.PI;\r\n    } else if (rotate < -Math.PI / 2) {\r\n      rotate += Math.PI;\r\n    }\r\n  } else if (typeof rotateType === 'number') {\r\n    rotate = rotateType * Math.PI / 180;\r\n  }\r\n\r\n  label.attr('rotation', rotate);\r\n\r\n  function getLabelAttr(name) {\r\n    var stateAttr = labelModel.get(name);\r\n\r\n    if (stateAttr == null) {\r\n      return normalModel.get(name);\r\n    } else {\r\n      return stateAttr;\r\n    }\r\n  }\r\n};\r\n\r\nSunburstPieceProto._initEvents = function (sector, node, seriesModel, highlightPolicy) {\r\n  sector.off('mouseover').off('mouseout').off('emphasis').off('normal');\r\n  var that = this;\r\n\r\n  var onEmphasis = function () {\r\n    that.onEmphasis(highlightPolicy);\r\n  };\r\n\r\n  var onNormal = function () {\r\n    that.onNormal();\r\n  };\r\n\r\n  var onDownplay = function () {\r\n    that.onDownplay();\r\n  };\r\n\r\n  var onHighlight = function () {\r\n    that.onHighlight();\r\n  };\r\n\r\n  if (seriesModel.isAnimationEnabled()) {\r\n    sector.on('mouseover', onEmphasis).on('mouseout', onNormal).on('emphasis', onEmphasis).on('normal', onNormal).on('downplay', onDownplay).on('highlight', onHighlight);\r\n  }\r\n};\r\n\r\nzrUtil.inherits(SunburstPiece, graphic.Group);\r\nvar _default = SunburstPiece;\r\n/**\r\n * Get node color\r\n *\r\n * @param {TreeNode} node the node to get color\r\n * @param {module:echarts/model/Series} seriesModel series\r\n * @param {module:echarts/model/Global} ecModel echarts defaults\r\n */\r\n\r\nfunction getNodeColor(node, seriesModel, ecModel) {\r\n  // Color from visualMap\r\n  var visualColor = node.getVisual('color');\r\n  var visualMetaList = node.getVisual('visualMeta');\r\n\r\n  if (!visualMetaList || visualMetaList.length === 0) {\r\n    // Use first-generation color if has no visualMap\r\n    visualColor = null;\r\n  } // Self color or level color\r\n\r\n\r\n  var color = node.getModel('itemStyle').get('color');\r\n\r\n  if (color) {\r\n    return color;\r\n  } else if (visualColor) {\r\n    // Color mapping\r\n    return visualColor;\r\n  } else if (node.depth === 0) {\r\n    // Virtual root node\r\n    return ecModel.option.color[0];\r\n  } else {\r\n    // First-generation color\r\n    var length = ecModel.option.color.length;\r\n    color = ecModel.option.color[getRootId(node) % length];\r\n  }\r\n\r\n  return color;\r\n}\r\n/**\r\n * Get index of root in sorted order\r\n *\r\n * @param {TreeNode} node current node\r\n * @return {number} index in root\r\n */\r\n\r\n\r\nfunction getRootId(node) {\r\n  var ancestor = node;\r\n\r\n  while (ancestor.depth > 1) {\r\n    ancestor = ancestor.parentNode;\r\n  }\r\n\r\n  var virtualRoot = node.getAncestors()[0];\r\n  return zrUtil.indexOf(virtualRoot.children, ancestor);\r\n}\r\n\r\nfunction isNodeHighlighted(node, activeNode, policy) {\r\n  if (policy === NodeHighlightPolicy.NONE) {\r\n    return false;\r\n  } else if (policy === NodeHighlightPolicy.SELF) {\r\n    return node === activeNode;\r\n  } else if (policy === NodeHighlightPolicy.ANCESTOR) {\r\n    return node === activeNode || node.isAncestorOf(activeNode);\r\n  } else {\r\n    return node === activeNode || node.isDescendantOf(activeNode);\r\n  }\r\n} // Fix tooltip callback function params.color incorrect when pick a default color\r\n\r\n\r\nfunction fillDefaultColor(node, seriesModel, color) {\r\n  var data = seriesModel.getData();\r\n  data.setItemVisual(node.dataIndex, 'color', color);\r\n}\r\n\r\nmodule.exports = _default;"]},"metadata":{},"sourceType":"script"}