import { __decorate, __param } from "tslib";
import { isPlatformBrowser } from '@angular/common';
import { Directive, ElementRef, Input, OnInit, OnDestroy, OnChanges, SimpleChanges, Optional, Inject, PLATFORM_ID } from '@angular/core';
import { LaddaConfig, LaddaConfigArgs, configAttributes } from './ladda-config';
import { create as createLadda } from 'ladda';
import * as ɵngcc0 from '@angular/core';
import * as ɵngcc1 from './ladda-config';
var LaddaDirective = /** @class */ (function () {
    function LaddaDirective(el, config, platformId) {
        this.platformId = platformId;
        this.el = el.nativeElement;
        if (!config) {
            return;
        }
        // apply default styles if they aren't overwritten by an attribute
        for (var attribute in configAttributes) {
            var configValue = config[configAttributes[attribute]];
            if (!configValue) {
                continue; // don't waste time reading the attribute
            }
            if (!this.el.getAttribute(attribute)) {
                // attribute isn't set - apply the default config value
                var value = (typeof configValue === "number") ? configValue.toString() : configValue;
                this.el.setAttribute(attribute, value);
            }
        }
    }
    LaddaDirective.prototype.ngOnChanges = function (changes) {
        if (!this.ladda) {
            return; // needed since ngOnChanges is called before ngOnInit
        }
        if (changes.loading) {
            this.updateLadda(changes.loading.previousValue);
        }
        if (changes.disabled) {
            this.updateDisabled();
        }
    };
    LaddaDirective.prototype.ngOnInit = function () {
        var _this = this;
        if (!isPlatformBrowser(this.platformId)) {
            return;
        }
        this.ladda = createLadda(this.el);
        // if the initial loading value isn't false, a timeout of 0 ms
        // is necessary for the calculated spinner size to be correct.
        setTimeout(function () { _this.updateLadda(false); }, 0);
    };
    LaddaDirective.prototype.ngOnDestroy = function () {
        if (this.ladda) {
            this.ladda.remove();
        }
    };
    LaddaDirective.prototype.updateLadda = function (previousValue) {
        var loading = typeof this.loading === 'number' || !!this.loading;
        var wasLoading = typeof previousValue === 'number' || !!previousValue;
        if (!loading) {
            if (wasLoading) {
                this.ladda.stop();
            }
            return this.updateDisabled();
        }
        if (!wasLoading) {
            this.ladda.start();
        }
        if (typeof this.loading === 'number') {
            this.ladda.setProgress(this.loading);
        }
    };
    LaddaDirective.prototype.updateDisabled = function () {
        this.el.disabled = this.disabled;
    };
    LaddaDirective.ctorParameters = function () { return [
        { type: ElementRef },
        { type: LaddaConfigArgs, decorators: [{ type: Inject, args: [LaddaConfig,] }, { type: Optional }] },
        { type: Object, decorators: [{ type: Inject, args: [PLATFORM_ID,] }] }
    ]; };
    __decorate([
        Input('ladda')
    ], LaddaDirective.prototype, "loading", void 0);
    __decorate([
        Input()
    ], LaddaDirective.prototype, "disabled", void 0);
    LaddaDirective = __decorate([ __param(1, Inject(LaddaConfig)), __param(1, Optional()),
        __param(2, Inject(PLATFORM_ID))
    ], LaddaDirective);
LaddaDirective.ɵfac = function LaddaDirective_Factory(t) { return new (t || LaddaDirective)(ɵngcc0.ɵɵdirectiveInject(ɵngcc0.ElementRef), ɵngcc0.ɵɵdirectiveInject(LaddaConfig, 8), ɵngcc0.ɵɵdirectiveInject(PLATFORM_ID)); };
LaddaDirective.ɵdir = ɵngcc0.ɵɵdefineDirective({ type: LaddaDirective, selectors: [["", "ladda", ""]], inputs: { loading: ["ladda", "loading"], disabled: "disabled" }, features: [ɵngcc0.ɵɵNgOnChangesFeature] });
/*@__PURE__*/ (function () { ɵngcc0.ɵsetClassMetadata(LaddaDirective, [{
        type: Directive,
        args: [{
                selector: '[ladda]'
            }]
    }], function () { return [{ type: ɵngcc0.ElementRef }, { type: ɵngcc1.LaddaConfigArgs, decorators: [{
                type: Inject,
                args: [LaddaConfig]
            }, {
                type: Optional
            }] }, { type: Object, decorators: [{
                type: Inject,
                args: [PLATFORM_ID]
            }] }]; }, { loading: [{
            type: Input,
            args: ['ladda']
        }], disabled: [{
            type: Input
        }] }); })();
    return LaddaDirective;
}());
export { LaddaDirective };
//# sourceMappingURL=data:application/json;charset=utf-8;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoibGFkZGEuZGlyZWN0aXZlLmpzIiwic291cmNlcyI6WyJhbmd1bGFyMi1sYWRkYS9saWIvbGFkZGEuZGlyZWN0aXZlLnRzIl0sIm5hbWVzIjpbXSwibWFwcGluZ3MiOiI7QUFBQSxPQUFPLEVBQUMsaUJBQWlCLEVBQUMsTUFBTSxpQkFBaUIsQ0FBQztBQUNsRCxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFDLE1BQU0sZUFBZSxDQUFDLHpJQUF2SSxPQUFPLEVBQUMsU0FBUyxFQUFFLFVBQVUsRUFBRSxLQUFLLEVBQUUsTUFBTSxFQUFFLFNBQVMsRUFBRSxTQUFTLEVBQUUsYUFBYSxFQUFFLFFBQVEsRUFBRSxNQUFNLEVBQUUsV0FBVyxFQUFDLE1BQU0sZUFBZSxDQUFDO0FBQ3ZJLE9BQU8sRUFBQyxXQUFXLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFDLE1BQU0sZ0JBQWdCLENBQUMsaEZBQTlFLE9BQU8sRUFBQyxXQUFXLEVBQUUsZUFBZSxFQUFFLGdCQUFnQixFQUFDLE1BQU0sZ0JBQWdCLENBQUM7QUFDOUUsT0FBTyxFQUFDLE1BQU0sSUFBSSxXQUFXLEVBQWMsTUFBTSxPQUFPLENBQUMsOUNBQXpELE9BQU8sRUFBQyxNQUFNLElBQUksV0FBVyxFQUFjLE1BQU0sT0FBTyxDQUFDO0FBT3pEO2FBT0ksd0JBQ0ksRUFBYyxFQUNtQjtLQUF1QixFQUMzQixVQUFrQixZQUFsQixlQUFVLEdBQVYsL0NBVnJDO09BVStDLENBQVEsU0FFL0MsSUFBSSxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsYUFBYSxDQUFDLFNBRTNCLHJEQWQwQyxJQU85Qyx3QkFDSSxFQUFjLEVBQ21CLE1BQXVCLEVBQzNCLFVBQWtCO0dBSTNDLENBQUMsTUFBTSxFQUFFLGNBQ1QsT0FBTyxqQ0FKakIsUUFEbUMsZUFBVSxHQUFWLFVBQVUsQ0FB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QWM7Ozs7Ozs7Ozs7Ozs7Ozs7Ozs7O29CQTJGM0I7QUFBQyxJQURELHFCQUFDO0FBQ0EsQ0FEQSxBQTFGRCxJQTBGQzs7QUFwR0EsQUFBQSxBQUFBLEFBQUEsQUFBQSxBQUFBLEFBQUEsQUFBQSIsInNvdXJjZXNDb250ZW50IjpbImltcG9ydCB7aXNQbGF0Zm9ybUJyb3dzZXJ9IGZyb20gJ0Bhbmd1bGFyL2NvbW1vbic7XHJcbmltcG9ydCB7RGlyZWN0aXZlLCBFbGVtZW50UmVmLCBJbnB1dCwgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcywgU2ltcGxlQ2hhbmdlcywgT3B0aW9uYWwsIEluamVjdCwgUExBVEZPUk1fSUR9IGZyb20gJ0Bhbmd1bGFyL2NvcmUnO1xyXG5pbXBvcnQge0xhZGRhQ29uZmlnLCBMYWRkYUNvbmZpZ0FyZ3MsIGNvbmZpZ0F0dHJpYnV0ZXN9IGZyb20gJy4vbGFkZGEtY29uZmlnJztcclxuaW1wb3J0IHtjcmVhdGUgYXMgY3JlYXRlTGFkZGEsIExhZGRhQnV0dG9ufSBmcm9tICdsYWRkYSc7XHJcblxyXG5leHBvcnQgdHlwZSBsYWRkYVZhbHVlID0gYm9vbGVhbiB8IG51bWJlciB8IHVuZGVmaW5lZCB8IG51bGw7XHJcblxyXG5ARGlyZWN0aXZlKHtcclxuICAgIHNlbGVjdG9yOiAnW2xhZGRhXSdcclxufSlcclxuZXhwb3J0IGNsYXNzIExhZGRhRGlyZWN0aXZlIGltcGxlbWVudHMgT25Jbml0LCBPbkRlc3Ryb3ksIE9uQ2hhbmdlcyB7XHJcbiAgICBwcml2YXRlIGVsOiBIVE1MQnV0dG9uRWxlbWVudDtcclxuICAgIHByaXZhdGUgbGFkZGE6IExhZGRhQnV0dG9uO1xyXG5cclxuICAgIEBJbnB1dCgnbGFkZGEnKSBsb2FkaW5nOiBsYWRkYVZhbHVlO1xyXG4gICAgQElucHV0KCkgZGlzYWJsZWQ6IGJvb2xlYW47XHJcblxyXG4gICAgY29uc3RydWN0b3IoXHJcbiAgICAgICAgZWw6IEVsZW1lbnRSZWYsXHJcbiAgICAgICAgQEluamVjdChMYWRkYUNvbmZpZykgQE9wdGlvbmFsKCkgY29uZmlnOiBMYWRkYUNvbmZpZ0FyZ3MsXHJcbiAgICAgICAgQEluamVjdChQTEFURk9STV9JRCkgcHJpdmF0ZSBwbGF0Zm9ybUlkOiBPYmplY3QsXHJcbiAgICApIHtcclxuICAgICAgICB0aGlzLmVsID0gZWwubmF0aXZlRWxlbWVudDtcclxuXHJcbiAgICAgICAgaWYgKCFjb25maWcpIHtcclxuICAgICAgICAgICAgcmV0dXJuO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgLy8gYXBwbHkgZGVmYXVsdCBzdHlsZXMgaWYgdGhleSBhcmVuJ3Qgb3ZlcndyaXR0ZW4gYnkgYW4gYXR0cmlidXRlXHJcbiAgICAgICAgZm9yIChsZXQgYXR0cmlidXRlIGluIGNvbmZpZ0F0dHJpYnV0ZXMpIHtcclxuICAgICAgICAgICAgbGV0IGNvbmZpZ1ZhbHVlID0gY29uZmlnW2NvbmZpZ0F0dHJpYnV0ZXNbYXR0cmlidXRlXV07XHJcblxyXG4gICAgICAgICAgICBpZiAoIWNvbmZpZ1ZhbHVlKSB7XHJcbiAgICAgICAgICAgICAgICBjb250aW51ZTsgLy8gZG9uJ3Qgd2FzdGUgdGltZSByZWFkaW5nIHRoZSBhdHRyaWJ1dGVcclxuICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgaWYgKCF0aGlzLmVsLmdldEF0dHJpYnV0ZShhdHRyaWJ1dGUpKSB7XHJcbiAgICAgICAgICAgICAgICAvLyBhdHRyaWJ1dGUgaXNuJ3Qgc2V0IC0gYXBwbHkgdGhlIGRlZmF1bHQgY29uZmlnIHZhbHVlXHJcbiAgICAgICAgICAgICAgICBsZXQgdmFsdWUgPSAodHlwZW9mIGNvbmZpZ1ZhbHVlID09PSBcIm51bWJlclwiKSA/IGNvbmZpZ1ZhbHVlLnRvU3RyaW5nKCkgOiBjb25maWdWYWx1ZTtcclxuICAgICAgICAgICAgICAgIHRoaXMuZWwuc2V0QXR0cmlidXRlKGF0dHJpYnV0ZSwgdmFsdWUpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfVxyXG4gICAgfVxyXG5cclxuICAgIG5nT25DaGFuZ2VzKGNoYW5nZXM6IFNpbXBsZUNoYW5nZXMpIHtcclxuICAgICAgICBpZiAoIXRoaXMubGFkZGEpIHtcclxuICAgICAgICAgICAgcmV0dXJuOyAvLyBuZWVkZWQgc2luY2UgbmdPbkNoYW5nZXMgaXMgY2FsbGVkIGJlZm9yZSBuZ09uSW5pdFxyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKGNoYW5nZXMubG9hZGluZykge1xyXG4gICAgICAgICAgICB0aGlzLnVwZGF0ZUxhZGRhKGNoYW5nZXMubG9hZGluZy5wcmV2aW91c1ZhbHVlKTtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIGlmIChjaGFuZ2VzLmRpc2FibGVkKSB7XHJcbiAgICAgICAgICAgIHRoaXMudXBkYXRlRGlzYWJsZWQoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkluaXQoKSB7XHJcbiAgICAgICAgaWYgKCFpc1BsYXRmb3JtQnJvd3Nlcih0aGlzLnBsYXRmb3JtSWQpKSB7XHJcbiAgICAgICAgICAgIHJldHVybjtcclxuICAgICAgICB9XHJcblxyXG4gICAgICAgIHRoaXMubGFkZGEgPSBjcmVhdGVMYWRkYSh0aGlzLmVsKTtcclxuXHJcbiAgICAgICAgLy8gaWYgdGhlIGluaXRpYWwgbG9hZGluZyB2YWx1ZSBpc24ndCBmYWxzZSwgYSB0aW1lb3V0IG9mIDAgbXNcclxuICAgICAgICAvLyBpcyBuZWNlc3NhcnkgZm9yIHRoZSBjYWxjdWxhdGVkIHNwaW5uZXIgc2l6ZSB0byBiZSBjb3JyZWN0LlxyXG4gICAgICAgIHNldFRpbWVvdXQoKCkgPT4geyB0aGlzLnVwZGF0ZUxhZGRhKGZhbHNlKTsgfSwgMCk7XHJcbiAgICB9XHJcblxyXG4gICAgbmdPbkRlc3Ryb3koKSB7XHJcbiAgICAgICAgaWYgKHRoaXMubGFkZGEpIHtcclxuICAgICAgICAgICAgdGhpcy5sYWRkYS5yZW1vdmUoKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVMYWRkYShwcmV2aW91c1ZhbHVlOiBsYWRkYVZhbHVlKTogdm9pZCB7XHJcbiAgICAgICAgbGV0IGxvYWRpbmc6IGJvb2xlYW4gPSB0eXBlb2YgdGhpcy5sb2FkaW5nID09PSAnbnVtYmVyJyB8fCAhIXRoaXMubG9hZGluZztcclxuICAgICAgICBsZXQgd2FzTG9hZGluZzogYm9vbGVhbiA9IHR5cGVvZiBwcmV2aW91c1ZhbHVlID09PSAnbnVtYmVyJyB8fCAhIXByZXZpb3VzVmFsdWU7XHJcblxyXG4gICAgICAgIGlmICghbG9hZGluZykge1xyXG4gICAgICAgICAgICBpZiAod2FzTG9hZGluZykge1xyXG4gICAgICAgICAgICAgICAgdGhpcy5sYWRkYS5zdG9wKCk7XHJcbiAgICAgICAgICAgIH1cclxuXHJcbiAgICAgICAgICAgIHJldHVybiB0aGlzLnVwZGF0ZURpc2FibGVkKCk7XHJcbiAgICAgICAgfVxyXG5cclxuICAgICAgICBpZiAoIXdhc0xvYWRpbmcpIHtcclxuICAgICAgICAgICAgdGhpcy5sYWRkYS5zdGFydCgpO1xyXG4gICAgICAgIH1cclxuXHJcbiAgICAgICAgaWYgKHR5cGVvZiB0aGlzLmxvYWRpbmcgPT09ICdudW1iZXInKSB7XHJcbiAgICAgICAgICAgIHRoaXMubGFkZGEuc2V0UHJvZ3Jlc3ModGhpcy5sb2FkaW5nKTtcclxuICAgICAgICB9XHJcbiAgICB9XHJcblxyXG4gICAgcHJpdmF0ZSB1cGRhdGVEaXNhYmxlZCgpOiB2b2lkIHtcclxuICAgICAgICB0aGlzLmVsLmRpc2FibGVkID0gdGhpcy5kaXNhYmxlZDtcclxuICAgIH1cclxufVxyXG4iXX0=